{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/PC/Documents/NextJS%20Projects/gamified-learning-system/lib/utils.ts"],"sourcesContent":["import { clsx, type ClassValue } from 'clsx'\nimport { twMerge } from 'tailwind-merge'\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,IAAA,yKAAO,EAAC,IAAA,gJAAI,EAAC;AACtB"}},
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/PC/Documents/NextJS%20Projects/gamified-learning-system/components/ui/card.tsx"],"sourcesContent":["import * as React from 'react'\n\nimport { cn } from '@/lib/utils'\n\nfunction Card({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card\"\n      className={cn(\n        'bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardHeader({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-header\"\n      className={cn(\n        '@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardTitle({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-title\"\n      className={cn('leading-none font-semibold', className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardDescription({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-description\"\n      className={cn('text-muted-foreground text-sm', className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardAction({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-action\"\n      className={cn(\n        'col-start-2 row-span-2 row-start-1 self-start justify-self-end',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardContent({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-content\"\n      className={cn('px-6', className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardFooter({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-footer\"\n      className={cn('flex items-center px-6 [.border-t]:pt-6', className)}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardAction,\n  CardDescription,\n  CardContent,\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAEA;;;AAEA,SAAS,KAAK,EAAE,SAAS,EAAE,GAAG,OAAoC;IAChE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,qFACA;QAED,GAAG,KAAK;;;;;;AAGf;KAXS;AAaT,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,4JACA;QAED,GAAG,KAAK;;;;;;AAGf;MAXS;AAaT,SAAS,UAAU,EAAE,SAAS,EAAE,GAAG,OAAoC;IACrE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,8BAA8B;QAC3C,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,gBAAgB,EAAE,SAAS,EAAE,GAAG,OAAoC;IAC3E,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,kEACA;QAED,GAAG,KAAK;;;;;;AAGf;MAXS;AAaT,SAAS,YAAY,EAAE,SAAS,EAAE,GAAG,OAAoC;IACvE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,QAAQ;QACrB,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,2CAA2C;QACxD,GAAG,KAAK;;;;;;AAGf;MARS"}},
    {"offset": {"line": 142, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/PC/Documents/NextJS%20Projects/gamified-learning-system/components/ui/button.tsx"],"sourcesContent":["import * as React from 'react'\nimport { Slot } from '@radix-ui/react-slot'\nimport { cva, type VariantProps } from 'class-variance-authority'\n\nimport { cn } from '@/lib/utils'\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive\",\n  {\n    variants: {\n      variant: {\n        default: 'bg-primary text-primary-foreground hover:bg-primary/90',\n        destructive:\n          'bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60',\n        outline:\n          'border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50',\n        secondary:\n          'bg-secondary text-secondary-foreground hover:bg-secondary/80',\n        ghost:\n          'hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50',\n        link: 'text-primary underline-offset-4 hover:underline',\n      },\n      size: {\n        default: 'h-9 px-4 py-2 has-[>svg]:px-3',\n        sm: 'h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5',\n        lg: 'h-10 rounded-md px-6 has-[>svg]:px-4',\n        icon: 'size-9',\n        'icon-sm': 'size-8',\n        'icon-lg': 'size-10',\n      },\n    },\n    defaultVariants: {\n      variant: 'default',\n      size: 'default',\n    },\n  },\n)\n\nfunction Button({\n  className,\n  variant,\n  size,\n  asChild = false,\n  ...props\n}: React.ComponentProps<'button'> &\n  VariantProps<typeof buttonVariants> & {\n    asChild?: boolean\n  }) {\n  const Comp = asChild ? Slot : 'button'\n\n  return (\n    <Comp\n      data-slot=\"button\"\n      className={cn(buttonVariants({ variant, size, className }))}\n      {...props}\n    />\n  )\n}\n\nexport { Button, buttonVariants }\n"],"names":[],"mappings":";;;;;;;AACA;AACA;AAEA;;;;;AAEA,MAAM,iBAAiB,IAAA,0KAAG,EACxB,+bACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aACE;YACF,SACE;YACF,WACE;YACF,OACE;YACF,MAAM;QACR;QACA,MAAM;YACJ,SAAS;YACT,IAAI;YACJ,IAAI;YACJ,MAAM;YACN,WAAW;YACX,WAAW;QACb;IACF;IACA,iBAAiB;QACf,SAAS;QACT,MAAM;IACR;AACF;AAGF,SAAS,OAAO,EACd,SAAS,EACT,OAAO,EACP,IAAI,EACJ,UAAU,KAAK,EACf,GAAG,OAIF;IACD,MAAM,OAAO,UAAU,2KAAI,GAAG;IAE9B,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,eAAe;YAAE;YAAS;YAAM;QAAU;QACvD,GAAG,KAAK;;;;;;AAGf;KAnBS"}},
    {"offset": {"line": 207, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/PC/Documents/NextJS%20Projects/gamified-learning-system/components/ui/radio-group.tsx"],"sourcesContent":["'use client'\n\nimport * as React from 'react'\nimport * as RadioGroupPrimitive from '@radix-ui/react-radio-group'\nimport { CircleIcon } from 'lucide-react'\n\nimport { cn } from '@/lib/utils'\n\nfunction RadioGroup({\n  className,\n  ...props\n}: React.ComponentProps<typeof RadioGroupPrimitive.Root>) {\n  return (\n    <RadioGroupPrimitive.Root\n      data-slot=\"radio-group\"\n      className={cn('grid gap-3', className)}\n      {...props}\n    />\n  )\n}\n\nfunction RadioGroupItem({\n  className,\n  ...props\n}: React.ComponentProps<typeof RadioGroupPrimitive.Item>) {\n  return (\n    <RadioGroupPrimitive.Item\n      data-slot=\"radio-group-item\"\n      className={cn(\n        'border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50',\n        className,\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator\n        data-slot=\"radio-group-indicator\"\n        className=\"relative flex items-center justify-center\"\n      >\n        <CircleIcon className=\"fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n}\n\nexport { RadioGroup, RadioGroupItem }\n"],"names":[],"mappings":";;;;;;;AAGA;AACA;AAEA;AANA;;;;;AAQA,SAAS,WAAW,EAClB,SAAS,EACT,GAAG,OACmD;IACtD,qBACE,6LAAC,qLAAwB;QACvB,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,cAAc;QAC3B,GAAG,KAAK;;;;;;AAGf;KAXS;AAaT,SAAS,eAAe,EACtB,SAAS,EACT,GAAG,OACmD;IACtD,qBACE,6LAAC,qLAAwB;QACvB,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,0XACA;QAED,GAAG,KAAK;kBAET,cAAA,6LAAC,0LAA6B;YAC5B,aAAU;YACV,WAAU;sBAEV,cAAA,6LAAC,2NAAU;gBAAC,WAAU;;;;;;;;;;;;;;;;AAI9B;MArBS"}},
    {"offset": {"line": 272, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/PC/Documents/NextJS%20Projects/gamified-learning-system/components/ui/label.tsx"],"sourcesContent":["'use client'\n\nimport * as React from 'react'\nimport * as LabelPrimitive from '@radix-ui/react-label'\n\nimport { cn } from '@/lib/utils'\n\nfunction Label({\n  className,\n  ...props\n}: React.ComponentProps<typeof LabelPrimitive.Root>) {\n  return (\n    <LabelPrimitive.Root\n      data-slot=\"label\"\n      className={cn(\n        'flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Label }\n"],"names":[],"mappings":";;;;;AAGA;AAEA;AALA;;;;AAOA,SAAS,MAAM,EACb,SAAS,EACT,GAAG,OAC8C;IACjD,qBACE,6LAAC,4KAAmB;QAClB,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,uNACA;QAED,GAAG,KAAK;;;;;;AAGf;KAdS"}},
    {"offset": {"line": 305, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/PC/Documents/NextJS%20Projects/gamified-learning-system/app/actions/courses.ts"],"sourcesContent":["\"use server\"\n\nimport { redirect } from \"next/navigation\"\nimport sql from \"@/lib/db\"\nimport { revalidatePath } from \"next/cache\"\nimport { writeFile, mkdir } from \"fs/promises\"\nimport { join } from \"path\"\nimport { randomUUID } from \"crypto\"\n\nexport async function createCourse(formData: {\n  title: string\n  description: string\n  difficulty: string\n  points_reward: number\n  thumbnail_url?: string\n  teacher_id: number | string\n  is_published: boolean\n}) {\n  try {\n    const result = await sql`\n      INSERT INTO courses (title, description, difficulty, points_reward, thumbnail_url, teacher_id, is_published)\n      VALUES (\n        ${formData.title},\n        ${formData.description},\n        ${formData.difficulty},\n        ${formData.points_reward},\n        ${formData.thumbnail_url || null},\n        ${parseInt(formData.teacher_id.toString())},\n        ${formData.is_published}\n      )\n      RETURNING id\n    `\n\n    const courseId = result[0].id\n\n    // Create modules\n    const modules = [\n      { title: 'Course Introduction', description: 'Get started with this course and understand what you will learn', order_index: 1 },\n      { title: 'Core Concepts', description: 'Learn the fundamental concepts and principles', order_index: 2 },\n      { title: 'Practical Application', description: 'Apply what you have learned through hands-on exercises', order_index: 3 },\n      { title: 'Advanced Topics', description: 'Explore advanced concepts and best practices', order_index: 4 }\n    ]\n\n    const moduleIds = []\n    for (const module of modules) {\n      const moduleResult = await sql`\n        INSERT INTO modules (course_id, title, description, order_index)\n        VALUES (${courseId}, ${module.title}, ${module.description}, ${module.order_index})\n        RETURNING id\n      `\n      moduleIds.push(moduleResult[0].id)\n    }\n\n    // Create lessons for each module\n    const lessons = [\n      // Module 1: Introduction\n      [\n        {\n          title: 'Welcome to the Course',\n          content: `Welcome to ${formData.title}!\n\nThis course will guide you through the essential concepts and skills you need to succeed. By the end of this course, you will have a solid understanding of the topic and be able to apply what you've learned.\n\nWhat you will learn:\n- Fundamental concepts and principles\n- Practical applications and examples\n- Best practices and common patterns\n- Hands-on exercises and projects\n\nLet's get started on this learning journey!`,\n          points_reward: 5\n        },\n        {\n          title: 'Course Overview and Objectives',\n          content: `In this lesson, we will explore:\n\n• The main topics covered in this course\n• Learning objectives and outcomes\n• Prerequisites and requirements\n• Course structure and progression\n• Assessment methods and grading criteria\n\nUnderstanding these elements will help you make the most of your learning experience.`,\n          points_reward: 5\n        }\n      ],\n      // Module 2: Core Concepts\n      [\n        {\n          title: 'Fundamental Principles',\n          content: `Let's dive into the core principles that form the foundation of this subject.\n\nKey concepts covered:\n• Basic terminology and definitions\n• Core principles and theories\n• Fundamental relationships and dependencies\n• Common patterns and structures\n\nThese foundational concepts will be referenced throughout the course.`,\n          points_reward: 5\n        },\n        {\n          title: 'Essential Concepts',\n          content: `Building on the fundamentals, this lesson covers essential concepts that are critical to understanding the subject.\n\nTopics include:\n• Key frameworks and models\n• Important relationships and interactions\n• Critical thinking approaches\n• Problem-solving methodologies\n\nMastering these concepts will give you a strong foundation for advanced topics.`,\n          points_reward: 5\n        }\n      ],\n      // Module 3: Practical Application\n      [\n        {\n          title: 'Hands-on Practice',\n          content: `Now it's time to apply what you've learned through practical exercises.\n\nIn this lesson, you will:\n• Work through guided examples\n• Complete interactive exercises\n• Apply concepts to real-world scenarios\n• Receive immediate feedback on your work\n\nPractice is essential for reinforcing learning and building confidence.`,\n          points_reward: 10\n        },\n        {\n          title: 'Project Work',\n          content: `This lesson focuses on applying your knowledge to a comprehensive project.\n\nProject components:\n• Planning and design phase\n• Implementation and development\n• Testing and validation\n• Documentation and presentation\n\nCompleting this project will demonstrate your mastery of the course material.`,\n          points_reward: 10\n        }\n      ],\n      // Module 4: Advanced Topics\n      [\n        {\n          title: 'Advanced Concepts',\n          content: `Explore advanced topics and cutting-edge developments in the field.\n\nAdvanced topics covered:\n• Emerging trends and technologies\n• Complex problem-solving scenarios\n• Integration with other systems\n• Future directions and possibilities\n\nThese advanced concepts will prepare you for professional applications.`,\n          points_reward: 5\n        },\n        {\n          title: 'Best Practices and Next Steps',\n          content: `This final lesson covers best practices and provides guidance for continued learning.\n\nTopics include:\n• Industry best practices and standards\n• Common pitfalls and how to avoid them\n• Resources for further learning\n• Career applications and opportunities\n• Staying current with developments\n\nCongratulations on completing this course!`,\n          points_reward: 5\n        }\n      ]\n    ]\n\n    for (let i = 0; i < lessons.length; i++) {\n      const moduleLessons = lessons[i]\n      for (let j = 0; j < moduleLessons.length; j++) {\n        const lesson = moduleLessons[j]\n        await sql`\n          INSERT INTO lessons (module_id, title, content, video_url, order_index, points_reward)\n          VALUES (\n            ${moduleIds[i]},\n            ${lesson.title},\n            ${lesson.content},\n            null,\n            ${j + 1},\n            ${lesson.points_reward}\n          )\n        `\n      }\n    }\n\n    // Create quizzes for some lessons\n    const quizLessons = [2, 4, 6, 8] // One quiz per module\n    for (let i = 0; i < quizLessons.length; i++) {\n      const lessonIndex = quizLessons[i] - 1 // Convert to 0-based\n      const moduleIndex = Math.floor(lessonIndex / 2)\n      const lessonInModule = (lessonIndex % 2) + 1\n\n      // Find the actual lesson ID\n      const lessonResult = await sql`\n        SELECT id FROM lessons\n        WHERE module_id = ${moduleIds[moduleIndex]}\n        AND order_index = ${lessonInModule}\n      `\n\n      if (lessonResult.length > 0) {\n        const lessonId = lessonResult[0].id\n        const quizResult = await sql`\n          INSERT INTO quizzes (lesson_id, title, description, passing_score, points_reward)\n          VALUES (\n            ${lessonId},\n            'Module ${moduleIndex + 1} Quiz',\n            'Test your understanding of the concepts covered in Module ${moduleIndex + 1}',\n            70,\n            10\n          )\n          RETURNING id\n        `\n\n        const quizId = quizResult[0].id\n\n        // Add sample questions\n        const questions = [\n          {\n            question: 'What is the main concept covered in this module?',\n            options: '[\"Core principles\", \"Advanced topics\", \"Practical application\", \"Introduction\"]',\n            correct_answer: 'Core principles'\n          },\n          {\n            question: 'Which of the following is a key learning objective?',\n            options: '[\"Understanding fundamentals\", \"Memorizing facts\", \"Following instructions\", \"Completing assignments\"]',\n            correct_answer: 'Understanding fundamentals'\n          },\n          {\n            question: 'What should you do to master the material?',\n            options: '[\"Practice regularly\", \"Skip exercises\", \"Only read content\", \"Memorize answers\"]',\n            correct_answer: 'Practice regularly'\n          }\n        ]\n\n        for (let q = 0; q < questions.length; q++) {\n          await sql`\n            INSERT INTO quiz_questions (quiz_id, question, options, correct_answer, order_index)\n            VALUES (\n              ${quizId},\n              ${questions[q].question},\n              ${questions[q].options},\n              ${questions[q].correct_answer},\n              ${q + 1}\n            )\n          `\n        }\n      }\n    }\n\n    revalidatePath(\"/admin/courses\")\n    revalidatePath(\"/tutor\")\n    return { success: true, courseId }\n  } catch (error) {\n    console.error(\"[v0] Create course error:\", error)\n    return { success: false, error: \"Failed to create course\" }\n  }\n}\n\nexport async function updateCourse(courseId: number, formData: {\n  title: string\n  description: string\n  difficulty: string\n  points_reward: number\n  thumbnail_url?: string\n  teacher_id: number | string\n  is_published: boolean\n}) {\n  try {\n    await sql`\n      UPDATE courses\n      SET title = ${formData.title},\n          description = ${formData.description},\n          difficulty = ${formData.difficulty},\n          points_reward = ${formData.points_reward},\n          thumbnail_url = ${formData.thumbnail_url || null},\n          teacher_id = ${parseInt(formData.teacher_id.toString())},\n          is_published = ${formData.is_published}\n      WHERE id = ${courseId}\n    `\n\n    revalidatePath(\"/admin/courses\")\n    revalidatePath(`/admin/courses/${courseId}/edit`)\n    return { success: true }\n  } catch (error) {\n    console.error(\"[v0] Update course error:\", error)\n    return { success: false, error: \"Failed to update course\" }\n  }\n}\n\nexport async function enrollInCourse(formData: FormData) {\n  const courseId = Number.parseInt(formData.get(\"courseId\") as string)\n  const userId = Number.parseInt(formData.get(\"userId\") as string)\n\n  try {\n    await sql`\n      INSERT INTO enrollments (user_id, course_id)\n      VALUES (${userId}, ${courseId})\n    `\n\n    // Award achievement to student\n    await sql`\n      INSERT INTO achievements (user_id, type, title, description, points_earned)\n      VALUES (\n        ${userId},\n        'course_enrolled',\n        'New Course Enrolled',\n        'Started a new learning journey',\n        5\n      )\n    `\n\n    // Update student points\n    await sql`\n      UPDATE users\n      SET points = points + 5\n      WHERE id = ${userId}\n    `\n\n    // Check for Knowledge Seeker badge for student\n    const enrollmentCount = await sql`\n      SELECT COUNT(DISTINCT course_id) as count FROM enrollments WHERE user_id = ${userId}\n    `\n\n    if (enrollmentCount[0].count >= 3) {\n      const badge = await sql`\n        SELECT id FROM badges WHERE name = 'Knowledge Seeker'\n      `\n\n      if (badge.length > 0) {\n        await sql`\n          INSERT INTO user_badges (user_id, badge_id)\n          VALUES (${userId}, ${badge[0].id})\n          ON CONFLICT DO NOTHING\n        `\n      }\n    }\n\n    // Check for Popular Teacher badge\n    const teacherData = await sql`\n      SELECT teacher_id FROM courses WHERE id = ${courseId}\n    `\n\n    if (teacherData.length > 0) {\n      const teacherId = teacherData[0].teacher_id\n\n      const totalEnrollments = await sql`\n        SELECT COUNT(*) as count\n        FROM enrollments e\n        JOIN courses c ON e.course_id = c.id\n        WHERE c.teacher_id = ${teacherId}\n      `\n\n      if (totalEnrollments[0].count >= 10) {\n        const badge = await sql`\n          SELECT id FROM badges WHERE name = 'Popular Teacher'\n        `\n\n        if (badge.length > 0) {\n          await sql`\n            INSERT INTO user_badges (user_id, badge_id)\n            VALUES (${teacherId}, ${badge[0].id})\n            ON CONFLICT DO NOTHING\n          `\n        }\n      }\n    }\n\n    revalidatePath(`/courses/${courseId}`)\n    redirect(`/courses/${courseId}`)\n  } catch (error) {\n    console.error(\"[v0] Enrollment error:\", error)\n  }\n\n  revalidatePath(`/courses/${courseId}`)\n  redirect(`/courses/${courseId}`)\n}\n\nexport async function uploadCourseThumbnail(formData: FormData) {\n  try {\n    const file = formData.get(\"thumbnail\") as File\n\n    if (!file || file.size === 0) {\n      return { success: false, error: \"No file provided\" }\n    }\n\n    // Validate file type\n    if (!file.type.startsWith(\"image/\")) {\n      return { success: false, error: \"File must be an image\" }\n    }\n\n    // Validate file size (max 5MB)\n    if (file.size > 5 * 1024 * 1024) {\n      return { success: false, error: \"File size must be less than 5MB\" }\n    }\n\n    // Generate unique filename\n    const fileExtension = file.name.split(\".\").pop()\n    const fileName = `${randomUUID()}.${fileExtension}`\n\n    // Create uploads directory if it doesn't exist\n    const uploadsDir = join(process.cwd(), \"public\", \"uploads\", \"courses\")\n    try {\n      await mkdir(uploadsDir, { recursive: true })\n    } catch (error) {\n      // Directory might already exist\n    }\n\n    // Save file\n    const filePath = join(uploadsDir, fileName)\n    const bytes = await file.arrayBuffer()\n    const buffer = Buffer.from(bytes)\n    await writeFile(filePath, buffer)\n\n    // Return the public URL\n    const publicUrl = `/uploads/courses/${fileName}`\n    return { success: true, url: publicUrl }\n  } catch (error) {\n    console.error(\"[v0] Upload error:\", error)\n    return { success: false, error: \"Failed to upload file\" }\n  }\n}\n\nexport async function createCourseWithContent(formData: {\n  title: string\n  description: string\n  difficulty: string\n  points_reward: number\n  thumbnail_url?: string\n  teacher_id: string\n  is_published: boolean\n  modules: Array<{\n    title: string\n    description: string\n    lessons: Array<{\n      title: string\n      content: string\n      points_reward: number\n    }>\n    quiz?: {\n      title: string\n      passing_score: number\n      points_reward: number\n      questions: Array<{\n        question: string\n        answers: string[]\n        correct_answer_index: number\n      }>\n    }\n  }>\n}) {\n  try {\n    const result = await sql`\n      INSERT INTO courses (title, description, difficulty, points_reward, thumbnail_url, teacher_id, is_published)\n      VALUES (\n        ${formData.title},\n        ${formData.description},\n        ${formData.difficulty},\n        ${formData.points_reward},\n        ${formData.thumbnail_url || null},\n        ${parseInt(formData.teacher_id)},\n        ${formData.is_published}\n      )\n      RETURNING id\n    `\n\n    const courseId = result[0].id\n\n    // Create modules and their content\n    for (let i = 0; i < formData.modules.length; i++) {\n      const module = formData.modules[i]\n\n      const moduleResult = await sql`\n        INSERT INTO modules (course_id, title, description, order_index)\n        VALUES (${courseId}, ${module.title}, ${module.description}, ${i + 1})\n        RETURNING id\n      `\n\n      const moduleId = moduleResult[0].id\n\n      // Create lessons\n      for (let j = 0; j < module.lessons.length; j++) {\n        const lesson = module.lessons[j]\n\n        await sql`\n          INSERT INTO lessons (module_id, title, content, video_url, order_index, points_reward)\n          VALUES (\n            ${moduleId},\n            ${lesson.title},\n            ${lesson.content},\n            null,\n            ${j + 1},\n            ${lesson.points_reward}\n          )\n        `\n      }\n\n      // Create quiz if provided at module level\n      if (module.quiz) {\n        const quizResult = await sql`\n          INSERT INTO quizzes (module_id, title, passing_score, points_reward)\n          VALUES (\n            ${moduleId},\n            ${module.quiz.title},\n            ${module.quiz.passing_score},\n            ${module.quiz.points_reward}\n          )\n          RETURNING id\n        `\n\n        const quizId = quizResult[0].id\n\n        // Create questions\n        for (let k = 0; k < module.quiz.questions.length; k++) {\n          const question = module.quiz.questions[k]\n          const optionsJson = JSON.stringify(question.answers)\n          const correctAnswer = String.fromCharCode(65 + question.correct_answer_index) // A, B, C, D\n\n          await sql`\n            INSERT INTO quiz_questions (quiz_id, question, options, correct_answer, order_index)\n            VALUES (\n              ${quizId},\n              ${question.question},\n              ${optionsJson},\n              ${correctAnswer},\n              ${k + 1}\n            )\n          `\n        }\n      }\n    }\n\n    revalidatePath(\"/tutor\")\n    return { success: true, courseId }\n  } catch (error) {\n    console.error(\"[v0] Create course with content error:\", error)\n    return { success: false, error: \"Failed to create course\" }\n  }\n}\n\nexport async function completeLesson(formData: FormData) {\n  const lessonId = Number.parseInt(formData.get(\"lessonId\") as string)\n  const userId = Number.parseInt(formData.get(\"userId\") as string)\n  const courseId = Number.parseInt(formData.get(\"courseId\") as string)\n\n  try {\n    // Check if already completed\n    const existing = await sql`\n      SELECT * FROM lesson_progress\n      WHERE user_id = ${userId} AND lesson_id = ${lessonId}\n    `\n\n    if (existing.length > 0) {\n      return { success: false, error: \"Already completed\" }\n    }\n\n    // Mark lesson as complete\n    await sql`\n      INSERT INTO lesson_progress (user_id, lesson_id, completed, completed_at)\n      VALUES (${userId}, ${lessonId}, true, NOW())\n    `\n\n    // Get lesson points\n    const lessons = await sql`\n      SELECT points_reward FROM lessons WHERE id = ${lessonId}\n    `\n\n    const pointsReward = lessons[0]?.points_reward || 5\n\n    // Award points to student\n    await sql`\n      UPDATE users\n      SET points = points + ${pointsReward}\n      WHERE id = ${userId}\n    `\n\n    // Award points to teacher (1 point per lesson completion)\n    const teacherData = await sql`\n      SELECT c.teacher_id\n      FROM courses c\n      JOIN modules m ON c.id = m.course_id\n      JOIN lessons l ON m.id = l.module_id\n      WHERE l.id = ${lessonId}\n    `\n\n    if (teacherData.length > 0) {\n      const teacherId = teacherData[0].teacher_id\n      await sql`\n        UPDATE users\n        SET points = points + 1\n        WHERE id = ${teacherId}\n      `\n      await updateUserLevel(teacherId)\n    }\n\n    await updateUserLevel(userId)\n\n    await updateStreak(userId)\n\n    await updateDailyChallengeProgress(userId, \"lessons_completed\", 1)\n\n    // Create achievement for student\n    await sql`\n      INSERT INTO achievements (user_id, type, title, description, points_earned)\n      VALUES (\n        ${userId},\n        'lesson_completed',\n        'Lesson Complete',\n        'Completed a lesson',\n        ${pointsReward}\n      )\n    `\n\n    // Check if user should get \"First Steps\" badge\n    const lessonCount = await sql`\n      SELECT COUNT(*) as count FROM lesson_progress\n      WHERE user_id = ${userId} AND completed = true\n    `\n\n    if (lessonCount[0].count === 1) {\n      const badge = await sql`\n        SELECT id FROM badges WHERE name = 'First Steps'\n      `\n\n      if (badge.length > 0) {\n        await sql`\n          INSERT INTO user_badges (user_id, badge_id)\n          VALUES (${userId}, ${badge[0].id})\n          ON CONFLICT DO NOTHING\n        `\n      }\n    }\n\n    // Update course progress\n    await updateCourseProgress(userId, courseId)\n\n    revalidatePath(`/courses/${courseId}/lessons/${lessonId}`)\n    return { success: true }\n  } catch (error) {\n    console.error(\"[v0] Complete lesson error:\", error)\n    return { success: false, error: \"Failed to complete lesson\" }\n  }\n}\n\nexport async function submitQuiz(formData: FormData) {\n  const quizId = Number.parseInt(formData.get(\"quizId\") as string)\n  const userId = Number.parseInt(formData.get(\"userId\") as string)\n  const lessonId = Number.parseInt(formData.get(\"lessonId\") as string)\n  const courseId = Number.parseInt(formData.get(\"courseId\") as string)\n  const answersJson = formData.get(\"answers\") as string\n  const answers = JSON.parse(answersJson)\n\n  try {\n    // Get quiz details and questions\n    const quizzes = await sql`\n      SELECT * FROM quizzes WHERE id = ${quizId}\n    `\n\n    const quiz = quizzes[0]\n\n    const questions = await sql`\n      SELECT * FROM quiz_questions WHERE quiz_id = ${quizId}\n    `\n\n    // Calculate score\n    let correctCount = 0\n    questions.forEach((q) => {\n      if (answers[q.id] === q.correct_answer) {\n        correctCount++\n      }\n    })\n\n    const score = Math.round((correctCount / questions.length) * 100)\n    const passed = score >= quiz.passing_score\n\n    // Record attempt\n    await sql`\n      INSERT INTO quiz_attempts (user_id, quiz_id, score, answers, passed)\n      VALUES (${userId}, ${quizId}, ${score}, ${answersJson}, ${passed})\n    `\n\n    if (passed) {\n      // Award points\n      await sql`\n        UPDATE users \n        SET points = points + ${quiz.points_reward}\n        WHERE id = ${userId}\n      `\n\n      // Create achievement\n      await sql`\n        INSERT INTO achievements (user_id, type, title, description, points_earned)\n        VALUES (\n          ${userId}, \n          'quiz_passed', \n          'Quiz Passed',\n          'Successfully passed a quiz',\n          ${quiz.points_reward}\n        )\n      `\n\n      // Check for Quiz Master badge\n      const perfectQuizzes = await sql`\n        SELECT COUNT(*) as count FROM quiz_attempts\n        WHERE user_id = ${userId} AND score = 100\n      `\n\n      if (perfectQuizzes[0].count >= 3) {\n        const badge = await sql`\n          SELECT id FROM badges WHERE name = 'Quiz Master'\n        `\n\n        if (badge.length > 0) {\n          await sql`\n            INSERT INTO user_badges (user_id, badge_id)\n            VALUES (${userId}, ${badge[0].id})\n            ON CONFLICT DO NOTHING\n          `\n        }\n      }\n    }\n\n    revalidatePath(`/courses/${courseId}/lessons/${lessonId}`)\n    return { success: true, score, passed }\n  } catch (error) {\n    console.error(\"[v0] Submit quiz error:\", error)\n    return { success: false, error: \"Failed to submit quiz\" }\n  }\n}\n\nasync function updateCourseProgress(userId: number, courseId: number) {\n  // Get total lessons in course\n  const totalLessons = await sql`\n    SELECT COUNT(*) as count\n    FROM lessons l\n    JOIN modules m ON l.module_id = m.id\n    WHERE m.course_id = ${courseId}\n  `\n\n  // Get completed lessons\n  const completedLessons = await sql`\n    SELECT COUNT(*) as count\n    FROM lesson_progress lp\n    JOIN lessons l ON lp.lesson_id = l.id\n    JOIN modules m ON l.module_id = m.id\n    WHERE lp.user_id = ${userId} \n    AND m.course_id = ${courseId}\n    AND lp.completed = true\n  `\n\n  const total = totalLessons[0].count\n  const completed = completedLessons[0].count\n  const progress = total > 0 ? Math.round((completed / total) * 100) : 0\n\n  // Update enrollment\n  await sql`\n    UPDATE enrollments \n    SET progress = ${progress},\n        status = CASE WHEN ${progress} = 100 THEN 'completed' ELSE 'active' END,\n        completed_at = CASE WHEN ${progress} = 100 THEN NOW() ELSE NULL END\n    WHERE user_id = ${userId} AND course_id = ${courseId}\n  `\n\n  // If completed, award course completion points\n  if (progress === 100) {\n    const courses = await sql`\n      SELECT points_reward, teacher_id FROM courses WHERE id = ${courseId}\n    `\n\n    const pointsReward = courses[0]?.points_reward || 100\n    const teacherId = courses[0]?.teacher_id\n\n    // Award points to student\n    await sql`\n      UPDATE users\n      SET points = points + ${pointsReward}\n      WHERE id = ${userId}\n    `\n\n    // Award points to teacher (10 points per course completion)\n    if (teacherId) {\n      await sql`\n        UPDATE users\n        SET points = points + 10\n        WHERE id = ${teacherId}\n      `\n      await updateUserLevel(teacherId)\n    }\n\n    await sql`\n      INSERT INTO achievements (user_id, type, title, description, points_earned)\n      VALUES (\n        ${userId},\n        'course_completed',\n        'Course Complete',\n        'Finished an entire course',\n        ${pointsReward}\n      )\n    `\n\n    // Check for Course Champion badge for student\n    const badge = await sql`\n      SELECT id FROM badges WHERE name = 'Course Champion'\n    `\n\n    if (badge.length > 0) {\n      await sql`\n        INSERT INTO user_badges (user_id, badge_id)\n        VALUES (${userId}, ${badge[0].id})\n        ON CONFLICT DO NOTHING\n      `\n    }\n\n    // Check for teacher badges\n    if (teacherId) {\n      const totalCompletions = await sql`\n        SELECT COUNT(*) as count\n        FROM enrollments e\n        JOIN courses c ON e.course_id = c.id\n        WHERE c.teacher_id = ${teacherId} AND e.status = 'completed'\n      `\n\n      const completionCount = totalCompletions[0].count\n\n      // Effective Teacher (5 completions)\n      if (completionCount >= 5) {\n        const badge = await sql`\n          SELECT id FROM badges WHERE name = 'Effective Teacher'\n        `\n\n        if (badge.length > 0) {\n          await sql`\n            INSERT INTO user_badges (user_id, badge_id)\n            VALUES (${teacherId}, ${badge[0].id})\n            ON CONFLICT DO NOTHING\n          `\n        }\n      }\n\n      // Master Educator (20 completions)\n      if (completionCount >= 20) {\n        const badge = await sql`\n          SELECT id FROM badges WHERE name = 'Master Educator'\n        `\n\n        if (badge.length > 0) {\n          await sql`\n            INSERT INTO user_badges (user_id, badge_id)\n            VALUES (${teacherId}, ${badge[0].id})\n            ON CONFLICT DO NOTHING\n          `\n        }\n      }\n    }\n  }\n}\n\n// Helper function to update user level based on points\nasync function updateUserLevel(userId: number) {\n  const userData = await sql`\n    SELECT points, level FROM users WHERE id = ${userId}\n  `\n\n  if (userData.length === 0) return\n\n  const { points, level } = userData[0]\n\n  // Level calculation: level = floor(points / 100) + 1\n  const newLevel = Math.floor(points / 100) + 1\n\n  if (newLevel > level) {\n    await sql`\n      UPDATE users SET level = ${newLevel} WHERE id = ${userId}\n    `\n\n    // Award achievement for leveling up\n    await sql`\n      INSERT INTO achievements (user_id, type, title, description, points_earned)\n      VALUES (\n        ${userId}, \n        'level_up', \n        'Level Up!',\n        ${`Reached level ${newLevel}`},\n        10\n      )\n    `\n\n    // Check for level-based badges\n    if (newLevel === 5) {\n      const badge = await sql`SELECT id FROM badges WHERE name = 'Rising Star'`\n      if (badge.length > 0) {\n        await sql`\n          INSERT INTO user_badges (user_id, badge_id)\n          VALUES (${userId}, ${badge[0].id})\n          ON CONFLICT DO NOTHING\n        `\n      }\n    }\n\n    if (newLevel === 10) {\n      const badge = await sql`SELECT id FROM badges WHERE name = 'Overachiever'`\n      if (badge.length > 0) {\n        await sql`\n          INSERT INTO user_badges (user_id, badge_id)\n          VALUES (${userId}, ${badge[0].id})\n          ON CONFLICT DO NOTHING\n        `\n      }\n    }\n  }\n}\n\n// Helper function to update streak\nasync function updateStreak(userId: number) {\n  const today = new Date().toISOString().split(\"T\")[0]\n\n  const streakData = await sql`\n    SELECT * FROM user_streaks WHERE user_id = ${userId}\n  `\n\n  if (streakData.length === 0) {\n    // Create new streak\n    await sql`\n      INSERT INTO user_streaks (user_id, current_streak, longest_streak, last_activity_date)\n      VALUES (${userId}, 1, 1, ${today})\n    `\n  } else {\n    const streak = streakData[0]\n    const lastDate = streak.last_activity_date\n\n    if (lastDate === today) {\n      // Already updated today\n      return\n    }\n\n    const yesterday = new Date()\n    yesterday.setDate(yesterday.getDate() - 1)\n    const yesterdayStr = yesterday.toISOString().split(\"T\")[0]\n\n    if (lastDate === yesterdayStr) {\n      // Continuing streak\n      const newStreak = streak.current_streak + 1\n      const longestStreak = Math.max(newStreak, streak.longest_streak)\n\n      await sql`\n        UPDATE user_streaks \n        SET current_streak = ${newStreak},\n            longest_streak = ${longestStreak},\n            last_activity_date = ${today},\n            updated_at = NOW()\n        WHERE user_id = ${userId}\n      `\n\n      // Check for streak badges\n      if (newStreak === 7) {\n        const badge = await sql`SELECT id FROM badges WHERE name = 'Dedicated Learner'`\n        if (badge.length > 0) {\n          await sql`\n            INSERT INTO user_badges (user_id, badge_id)\n            VALUES (${userId}, ${badge[0].id})\n            ON CONFLICT DO NOTHING\n          `\n        }\n      }\n    } else {\n      // Streak broken, reset to 1\n      await sql`\n        UPDATE user_streaks \n        SET current_streak = 1,\n            last_activity_date = ${today},\n            updated_at = NOW()\n        WHERE user_id = ${userId}\n      `\n    }\n  }\n}\n\n// Helper function to update daily challenge progress\nasync function updateDailyChallengeProgress(userId: number, challengeType: string, increment: number) {\n  // Get active challenges of this type\n  const challenges = await sql`\n    SELECT id, target_value \n    FROM daily_challenges\n    WHERE challenge_type = ${challengeType}\n      AND start_date <= CURRENT_DATE \n      AND end_date >= CURRENT_DATE\n  `\n\n  for (const challenge of challenges) {\n    // Check if user has progress entry\n    const progress = await sql`\n      SELECT * FROM user_daily_challenges\n      WHERE user_id = ${userId} AND challenge_id = ${challenge.id}\n    `\n\n    if (progress.length === 0) {\n      // Create new progress entry\n      const newProgress = increment\n      const completed = newProgress >= challenge.target_value\n\n      await sql`\n        INSERT INTO user_daily_challenges (user_id, challenge_id, progress, completed, completed_at)\n        VALUES (${userId}, ${challenge.id}, ${newProgress}, ${completed}, ${completed ? \"NOW()\" : null})\n      `\n\n      if (completed) {\n        // Award points\n        const challengeData = await sql`\n          SELECT points_reward FROM daily_challenges WHERE id = ${challenge.id}\n        `\n        const pointsReward = challengeData[0]?.points_reward || 0\n\n        await sql`\n          UPDATE users SET points = points + ${pointsReward} WHERE id = ${userId}\n        `\n      }\n    } else if (!progress[0].completed) {\n      // Update existing progress\n      const newProgress = progress[0].progress + increment\n      const completed = newProgress >= challenge.target_value\n\n      await sql`\n        UPDATE user_daily_challenges\n        SET progress = ${newProgress},\n            completed = ${completed},\n            completed_at = ${completed ? \"NOW()\" : null}\n        WHERE user_id = ${userId} AND challenge_id = ${challenge.id}\n      `\n\n      if (completed) {\n        // Award points\n        const challengeData = await sql`\n          SELECT points_reward FROM daily_challenges WHERE id = ${challenge.id}\n        `\n        const pointsReward = challengeData[0]?.points_reward || 0\n\n        await sql`\n          UPDATE users SET points = points + ${pointsReward} WHERE id = ${userId}\n        `\n      }\n    }\n  }\n}\n"],"names":[],"mappings":";;;;;;;IA4oBsB,aAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 320, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/PC/Documents/NextJS%20Projects/gamified-learning-system/components/quiz-component.tsx"],"sourcesContent":["\"use client\"\n\nimport { useState } from \"react\"\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\"\nimport { Button } from \"@/components/ui/button\"\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\"\nimport { Label } from \"@/components/ui/label\"\nimport { submitQuiz } from \"@/app/actions/courses\"\nimport { Trophy, XCircle, CheckCircle2 } from \"lucide-react\"\n\ninterface Quiz {\n  id: number\n  title: string\n  description: string\n  passing_score: number\n  points_reward: number\n}\n\ninterface Question {\n  id: number\n  question: string\n  options: string[]\n  order_index: number\n}\n\ninterface QuizComponentProps {\n  quiz: Quiz\n  questions: Question[]\n  userId: number\n  lessonId: number\n  courseId: number\n}\n\nexport function QuizComponent({ quiz, questions, userId, lessonId, courseId }: QuizComponentProps) {\n  const [answers, setAnswers] = useState<Record<number, string>>({})\n  const [result, setResult] = useState<any>(null)\n  const [isSubmitting, setIsSubmitting] = useState(false)\n\n  const handleSubmit = async () => {\n    setIsSubmitting(true)\n\n    const formData = new FormData()\n    formData.append(\"quizId\", quiz.id.toString())\n    formData.append(\"userId\", userId.toString())\n    formData.append(\"lessonId\", lessonId.toString())\n    formData.append(\"courseId\", courseId.toString())\n    formData.append(\"answers\", JSON.stringify(answers))\n\n    const response = await submitQuiz(formData)\n    setResult(response)\n    setIsSubmitting(false)\n  }\n\n  const allAnswered = questions.every((q) => answers[q.id])\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <Trophy className=\"w-5 h-5 text-accent\" />\n          {quiz.title}\n        </CardTitle>\n        <CardDescription>{quiz.description}</CardDescription>\n        <p className=\"text-sm text-muted-foreground\">\n          Passing score: {quiz.passing_score}% | Reward: {quiz.points_reward} points\n        </p>\n      </CardHeader>\n      <CardContent className=\"space-y-6\">\n        {!result ? (\n          <>\n            {questions.map((question, index) => (\n              <div key={question.id} className=\"space-y-3\">\n                <Label className=\"text-base font-semibold text-foreground\">\n                  {index + 1}. {question.question}\n                </Label>\n                <RadioGroup\n                  value={answers[question.id]}\n                  onValueChange={(value) => setAnswers({ ...answers, [question.id]: value })}\n                >\n                  {question.options.map((option, optionIndex) => (\n                    <div key={optionIndex} className=\"flex items-center space-x-2\">\n                      <RadioGroupItem value={option} id={`q${question.id}-${optionIndex}`} />\n                      <Label htmlFor={`q${question.id}-${optionIndex}`} className=\"cursor-pointer\">\n                        {option}\n                      </Label>\n                    </div>\n                  ))}\n                </RadioGroup>\n              </div>\n            ))}\n\n            <Button\n              onClick={handleSubmit}\n              disabled={!allAnswered || isSubmitting}\n              className=\"w-full bg-primary hover:bg-primary-dark\"\n            >\n              {isSubmitting ? \"Submitting...\" : \"Submit Quiz\"}\n            </Button>\n          </>\n        ) : (\n          <div className=\"text-center py-8\">\n            {result.passed ? (\n              <>\n                <CheckCircle2 className=\"w-16 h-16 text-accent mx-auto mb-4\" />\n                <h3 className=\"text-2xl font-bold text-foreground mb-2\">Congratulations!</h3>\n                <p className=\"text-lg text-muted-foreground mb-4\">You scored {result.score}% and passed the quiz!</p>\n                <p className=\"text-accent font-semibold\">+{quiz.points_reward} points earned</p>\n              </>\n            ) : (\n              <>\n                <XCircle className=\"w-16 h-16 text-destructive mx-auto mb-4\" />\n                <h3 className=\"text-2xl font-bold text-foreground mb-2\">Keep Trying!</h3>\n                <p className=\"text-lg text-muted-foreground mb-4\">You scored {result.score}%. Try again!</p>\n                <Button\n                  onClick={() => {\n                    setResult(null)\n                    setAnswers({})\n                  }}\n                >\n                  Retake Quiz\n                </Button>\n              </>\n            )}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  )\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;;;AARA;;;;;;;;AAiCO,SAAS,cAAc,EAAE,IAAI,EAAE,SAAS,EAAE,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAsB;;IAC/F,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAyB,CAAC;IAChE,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAM;IAC1C,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,yKAAQ,EAAC;IAEjD,MAAM,eAAe;QACnB,gBAAgB;QAEhB,MAAM,WAAW,IAAI;QACrB,SAAS,MAAM,CAAC,UAAU,KAAK,EAAE,CAAC,QAAQ;QAC1C,SAAS,MAAM,CAAC,UAAU,OAAO,QAAQ;QACzC,SAAS,MAAM,CAAC,YAAY,SAAS,QAAQ;QAC7C,SAAS,MAAM,CAAC,YAAY,SAAS,QAAQ;QAC7C,SAAS,MAAM,CAAC,WAAW,KAAK,SAAS,CAAC;QAE1C,MAAM,WAAW,MAAM,IAAA,uKAAU,EAAC;QAClC,UAAU;QACV,gBAAgB;IAClB;IAEA,MAAM,cAAc,UAAU,KAAK,CAAC,CAAC,IAAM,OAAO,CAAC,EAAE,EAAE,CAAC;IAExD,qBACE,6LAAC,oIAAI;;0BACH,6LAAC,0IAAU;;kCACT,6LAAC,yIAAS;wBAAC,WAAU;;0CACnB,6LAAC,mNAAM;gCAAC,WAAU;;;;;;4BACjB,KAAK,KAAK;;;;;;;kCAEb,6LAAC,+IAAe;kCAAE,KAAK,WAAW;;;;;;kCAClC,6LAAC;wBAAE,WAAU;;4BAAgC;4BAC3B,KAAK,aAAa;4BAAC;4BAAa,KAAK,aAAa;4BAAC;;;;;;;;;;;;;0BAGvE,6LAAC,2IAAW;gBAAC,WAAU;0BACpB,CAAC,uBACA;;wBACG,UAAU,GAAG,CAAC,CAAC,UAAU,sBACxB,6LAAC;gCAAsB,WAAU;;kDAC/B,6LAAC,sIAAK;wCAAC,WAAU;;4CACd,QAAQ;4CAAE;4CAAG,SAAS,QAAQ;;;;;;;kDAEjC,6LAAC,oJAAU;wCACT,OAAO,OAAO,CAAC,SAAS,EAAE,CAAC;wCAC3B,eAAe,CAAC,QAAU,WAAW;gDAAE,GAAG,OAAO;gDAAE,CAAC,SAAS,EAAE,CAAC,EAAE;4CAAM;kDAEvE,SAAS,OAAO,CAAC,GAAG,CAAC,CAAC,QAAQ,4BAC7B,6LAAC;gDAAsB,WAAU;;kEAC/B,6LAAC,wJAAc;wDAAC,OAAO;wDAAQ,IAAI,CAAC,CAAC,EAAE,SAAS,EAAE,CAAC,CAAC,EAAE,aAAa;;;;;;kEACnE,6LAAC,sIAAK;wDAAC,SAAS,CAAC,CAAC,EAAE,SAAS,EAAE,CAAC,CAAC,EAAE,aAAa;wDAAE,WAAU;kEACzD;;;;;;;+CAHK;;;;;;;;;;;+BATN,SAAS,EAAE;;;;;sCAoBvB,6LAAC,wIAAM;4BACL,SAAS;4BACT,UAAU,CAAC,eAAe;4BAC1B,WAAU;sCAET,eAAe,kBAAkB;;;;;;;iDAItC,6LAAC;oBAAI,WAAU;8BACZ,OAAO,MAAM,iBACZ;;0CACE,6LAAC,wOAAY;gCAAC,WAAU;;;;;;0CACxB,6LAAC;gCAAG,WAAU;0CAA0C;;;;;;0CACxD,6LAAC;gCAAE,WAAU;;oCAAqC;oCAAY,OAAO,KAAK;oCAAC;;;;;;;0CAC3E,6LAAC;gCAAE,WAAU;;oCAA4B;oCAAE,KAAK,aAAa;oCAAC;;;;;;;;qDAGhE;;0CACE,6LAAC,0NAAO;gCAAC,WAAU;;;;;;0CACnB,6LAAC;gCAAG,WAAU;0CAA0C;;;;;;0CACxD,6LAAC;gCAAE,WAAU;;oCAAqC;oCAAY,OAAO,KAAK;oCAAC;;;;;;;0CAC3E,6LAAC,wIAAM;gCACL,SAAS;oCACP,UAAU;oCACV,WAAW,CAAC;gCACd;0CACD;;;;;;;;;;;;;;;;;;;;;;;;AAUjB;GA/FgB;KAAA"}},
    {"offset": {"line": 597, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/PC/Documents/NextJS%20Projects/gamified-learning-system/app/actions/courses.ts"],"sourcesContent":["\"use server\"\n\nimport { redirect } from \"next/navigation\"\nimport sql from \"@/lib/db\"\nimport { revalidatePath } from \"next/cache\"\nimport { writeFile, mkdir } from \"fs/promises\"\nimport { join } from \"path\"\nimport { randomUUID } from \"crypto\"\n\nexport async function createCourse(formData: {\n  title: string\n  description: string\n  difficulty: string\n  points_reward: number\n  thumbnail_url?: string\n  teacher_id: number | string\n  is_published: boolean\n}) {\n  try {\n    const result = await sql`\n      INSERT INTO courses (title, description, difficulty, points_reward, thumbnail_url, teacher_id, is_published)\n      VALUES (\n        ${formData.title},\n        ${formData.description},\n        ${formData.difficulty},\n        ${formData.points_reward},\n        ${formData.thumbnail_url || null},\n        ${parseInt(formData.teacher_id.toString())},\n        ${formData.is_published}\n      )\n      RETURNING id\n    `\n\n    const courseId = result[0].id\n\n    // Create modules\n    const modules = [\n      { title: 'Course Introduction', description: 'Get started with this course and understand what you will learn', order_index: 1 },\n      { title: 'Core Concepts', description: 'Learn the fundamental concepts and principles', order_index: 2 },\n      { title: 'Practical Application', description: 'Apply what you have learned through hands-on exercises', order_index: 3 },\n      { title: 'Advanced Topics', description: 'Explore advanced concepts and best practices', order_index: 4 }\n    ]\n\n    const moduleIds = []\n    for (const module of modules) {\n      const moduleResult = await sql`\n        INSERT INTO modules (course_id, title, description, order_index)\n        VALUES (${courseId}, ${module.title}, ${module.description}, ${module.order_index})\n        RETURNING id\n      `\n      moduleIds.push(moduleResult[0].id)\n    }\n\n    // Create lessons for each module\n    const lessons = [\n      // Module 1: Introduction\n      [\n        {\n          title: 'Welcome to the Course',\n          content: `Welcome to ${formData.title}!\n\nThis course will guide you through the essential concepts and skills you need to succeed. By the end of this course, you will have a solid understanding of the topic and be able to apply what you've learned.\n\nWhat you will learn:\n- Fundamental concepts and principles\n- Practical applications and examples\n- Best practices and common patterns\n- Hands-on exercises and projects\n\nLet's get started on this learning journey!`,\n          points_reward: 5\n        },\n        {\n          title: 'Course Overview and Objectives',\n          content: `In this lesson, we will explore:\n\n• The main topics covered in this course\n• Learning objectives and outcomes\n• Prerequisites and requirements\n• Course structure and progression\n• Assessment methods and grading criteria\n\nUnderstanding these elements will help you make the most of your learning experience.`,\n          points_reward: 5\n        }\n      ],\n      // Module 2: Core Concepts\n      [\n        {\n          title: 'Fundamental Principles',\n          content: `Let's dive into the core principles that form the foundation of this subject.\n\nKey concepts covered:\n• Basic terminology and definitions\n• Core principles and theories\n• Fundamental relationships and dependencies\n• Common patterns and structures\n\nThese foundational concepts will be referenced throughout the course.`,\n          points_reward: 5\n        },\n        {\n          title: 'Essential Concepts',\n          content: `Building on the fundamentals, this lesson covers essential concepts that are critical to understanding the subject.\n\nTopics include:\n• Key frameworks and models\n• Important relationships and interactions\n• Critical thinking approaches\n• Problem-solving methodologies\n\nMastering these concepts will give you a strong foundation for advanced topics.`,\n          points_reward: 5\n        }\n      ],\n      // Module 3: Practical Application\n      [\n        {\n          title: 'Hands-on Practice',\n          content: `Now it's time to apply what you've learned through practical exercises.\n\nIn this lesson, you will:\n• Work through guided examples\n• Complete interactive exercises\n• Apply concepts to real-world scenarios\n• Receive immediate feedback on your work\n\nPractice is essential for reinforcing learning and building confidence.`,\n          points_reward: 10\n        },\n        {\n          title: 'Project Work',\n          content: `This lesson focuses on applying your knowledge to a comprehensive project.\n\nProject components:\n• Planning and design phase\n• Implementation and development\n• Testing and validation\n• Documentation and presentation\n\nCompleting this project will demonstrate your mastery of the course material.`,\n          points_reward: 10\n        }\n      ],\n      // Module 4: Advanced Topics\n      [\n        {\n          title: 'Advanced Concepts',\n          content: `Explore advanced topics and cutting-edge developments in the field.\n\nAdvanced topics covered:\n• Emerging trends and technologies\n• Complex problem-solving scenarios\n• Integration with other systems\n• Future directions and possibilities\n\nThese advanced concepts will prepare you for professional applications.`,\n          points_reward: 5\n        },\n        {\n          title: 'Best Practices and Next Steps',\n          content: `This final lesson covers best practices and provides guidance for continued learning.\n\nTopics include:\n• Industry best practices and standards\n• Common pitfalls and how to avoid them\n• Resources for further learning\n• Career applications and opportunities\n• Staying current with developments\n\nCongratulations on completing this course!`,\n          points_reward: 5\n        }\n      ]\n    ]\n\n    for (let i = 0; i < lessons.length; i++) {\n      const moduleLessons = lessons[i]\n      for (let j = 0; j < moduleLessons.length; j++) {\n        const lesson = moduleLessons[j]\n        await sql`\n          INSERT INTO lessons (module_id, title, content, video_url, order_index, points_reward)\n          VALUES (\n            ${moduleIds[i]},\n            ${lesson.title},\n            ${lesson.content},\n            null,\n            ${j + 1},\n            ${lesson.points_reward}\n          )\n        `\n      }\n    }\n\n    // Create quizzes for some lessons\n    const quizLessons = [2, 4, 6, 8] // One quiz per module\n    for (let i = 0; i < quizLessons.length; i++) {\n      const lessonIndex = quizLessons[i] - 1 // Convert to 0-based\n      const moduleIndex = Math.floor(lessonIndex / 2)\n      const lessonInModule = (lessonIndex % 2) + 1\n\n      // Find the actual lesson ID\n      const lessonResult = await sql`\n        SELECT id FROM lessons\n        WHERE module_id = ${moduleIds[moduleIndex]}\n        AND order_index = ${lessonInModule}\n      `\n\n      if (lessonResult.length > 0) {\n        const lessonId = lessonResult[0].id\n        const quizResult = await sql`\n          INSERT INTO quizzes (lesson_id, title, description, passing_score, points_reward)\n          VALUES (\n            ${lessonId},\n            'Module ${moduleIndex + 1} Quiz',\n            'Test your understanding of the concepts covered in Module ${moduleIndex + 1}',\n            70,\n            10\n          )\n          RETURNING id\n        `\n\n        const quizId = quizResult[0].id\n\n        // Add sample questions\n        const questions = [\n          {\n            question: 'What is the main concept covered in this module?',\n            options: '[\"Core principles\", \"Advanced topics\", \"Practical application\", \"Introduction\"]',\n            correct_answer: 'Core principles'\n          },\n          {\n            question: 'Which of the following is a key learning objective?',\n            options: '[\"Understanding fundamentals\", \"Memorizing facts\", \"Following instructions\", \"Completing assignments\"]',\n            correct_answer: 'Understanding fundamentals'\n          },\n          {\n            question: 'What should you do to master the material?',\n            options: '[\"Practice regularly\", \"Skip exercises\", \"Only read content\", \"Memorize answers\"]',\n            correct_answer: 'Practice regularly'\n          }\n        ]\n\n        for (let q = 0; q < questions.length; q++) {\n          await sql`\n            INSERT INTO quiz_questions (quiz_id, question, options, correct_answer, order_index)\n            VALUES (\n              ${quizId},\n              ${questions[q].question},\n              ${questions[q].options},\n              ${questions[q].correct_answer},\n              ${q + 1}\n            )\n          `\n        }\n      }\n    }\n\n    revalidatePath(\"/admin/courses\")\n    revalidatePath(\"/tutor\")\n    return { success: true, courseId }\n  } catch (error) {\n    console.error(\"[v0] Create course error:\", error)\n    return { success: false, error: \"Failed to create course\" }\n  }\n}\n\nexport async function updateCourse(courseId: number, formData: {\n  title: string\n  description: string\n  difficulty: string\n  points_reward: number\n  thumbnail_url?: string\n  teacher_id: number | string\n  is_published: boolean\n}) {\n  try {\n    await sql`\n      UPDATE courses\n      SET title = ${formData.title},\n          description = ${formData.description},\n          difficulty = ${formData.difficulty},\n          points_reward = ${formData.points_reward},\n          thumbnail_url = ${formData.thumbnail_url || null},\n          teacher_id = ${parseInt(formData.teacher_id.toString())},\n          is_published = ${formData.is_published}\n      WHERE id = ${courseId}\n    `\n\n    revalidatePath(\"/admin/courses\")\n    revalidatePath(`/admin/courses/${courseId}/edit`)\n    return { success: true }\n  } catch (error) {\n    console.error(\"[v0] Update course error:\", error)\n    return { success: false, error: \"Failed to update course\" }\n  }\n}\n\nexport async function enrollInCourse(formData: FormData) {\n  const courseId = Number.parseInt(formData.get(\"courseId\") as string)\n  const userId = Number.parseInt(formData.get(\"userId\") as string)\n\n  try {\n    await sql`\n      INSERT INTO enrollments (user_id, course_id)\n      VALUES (${userId}, ${courseId})\n    `\n\n    // Award achievement to student\n    await sql`\n      INSERT INTO achievements (user_id, type, title, description, points_earned)\n      VALUES (\n        ${userId},\n        'course_enrolled',\n        'New Course Enrolled',\n        'Started a new learning journey',\n        5\n      )\n    `\n\n    // Update student points\n    await sql`\n      UPDATE users\n      SET points = points + 5\n      WHERE id = ${userId}\n    `\n\n    // Check for Knowledge Seeker badge for student\n    const enrollmentCount = await sql`\n      SELECT COUNT(DISTINCT course_id) as count FROM enrollments WHERE user_id = ${userId}\n    `\n\n    if (enrollmentCount[0].count >= 3) {\n      const badge = await sql`\n        SELECT id FROM badges WHERE name = 'Knowledge Seeker'\n      `\n\n      if (badge.length > 0) {\n        await sql`\n          INSERT INTO user_badges (user_id, badge_id)\n          VALUES (${userId}, ${badge[0].id})\n          ON CONFLICT DO NOTHING\n        `\n      }\n    }\n\n    // Check for Popular Teacher badge\n    const teacherData = await sql`\n      SELECT teacher_id FROM courses WHERE id = ${courseId}\n    `\n\n    if (teacherData.length > 0) {\n      const teacherId = teacherData[0].teacher_id\n\n      const totalEnrollments = await sql`\n        SELECT COUNT(*) as count\n        FROM enrollments e\n        JOIN courses c ON e.course_id = c.id\n        WHERE c.teacher_id = ${teacherId}\n      `\n\n      if (totalEnrollments[0].count >= 10) {\n        const badge = await sql`\n          SELECT id FROM badges WHERE name = 'Popular Teacher'\n        `\n\n        if (badge.length > 0) {\n          await sql`\n            INSERT INTO user_badges (user_id, badge_id)\n            VALUES (${teacherId}, ${badge[0].id})\n            ON CONFLICT DO NOTHING\n          `\n        }\n      }\n    }\n\n    revalidatePath(`/courses/${courseId}`)\n    redirect(`/courses/${courseId}`)\n  } catch (error) {\n    console.error(\"[v0] Enrollment error:\", error)\n  }\n\n  revalidatePath(`/courses/${courseId}`)\n  redirect(`/courses/${courseId}`)\n}\n\nexport async function uploadCourseThumbnail(formData: FormData) {\n  try {\n    const file = formData.get(\"thumbnail\") as File\n\n    if (!file || file.size === 0) {\n      return { success: false, error: \"No file provided\" }\n    }\n\n    // Validate file type\n    if (!file.type.startsWith(\"image/\")) {\n      return { success: false, error: \"File must be an image\" }\n    }\n\n    // Validate file size (max 5MB)\n    if (file.size > 5 * 1024 * 1024) {\n      return { success: false, error: \"File size must be less than 5MB\" }\n    }\n\n    // Generate unique filename\n    const fileExtension = file.name.split(\".\").pop()\n    const fileName = `${randomUUID()}.${fileExtension}`\n\n    // Create uploads directory if it doesn't exist\n    const uploadsDir = join(process.cwd(), \"public\", \"uploads\", \"courses\")\n    try {\n      await mkdir(uploadsDir, { recursive: true })\n    } catch (error) {\n      // Directory might already exist\n    }\n\n    // Save file\n    const filePath = join(uploadsDir, fileName)\n    const bytes = await file.arrayBuffer()\n    const buffer = Buffer.from(bytes)\n    await writeFile(filePath, buffer)\n\n    // Return the public URL\n    const publicUrl = `/uploads/courses/${fileName}`\n    return { success: true, url: publicUrl }\n  } catch (error) {\n    console.error(\"[v0] Upload error:\", error)\n    return { success: false, error: \"Failed to upload file\" }\n  }\n}\n\nexport async function createCourseWithContent(formData: {\n  title: string\n  description: string\n  difficulty: string\n  points_reward: number\n  thumbnail_url?: string\n  teacher_id: string\n  is_published: boolean\n  modules: Array<{\n    title: string\n    description: string\n    lessons: Array<{\n      title: string\n      content: string\n      points_reward: number\n    }>\n    quiz?: {\n      title: string\n      passing_score: number\n      points_reward: number\n      questions: Array<{\n        question: string\n        answers: string[]\n        correct_answer_index: number\n      }>\n    }\n  }>\n}) {\n  try {\n    const result = await sql`\n      INSERT INTO courses (title, description, difficulty, points_reward, thumbnail_url, teacher_id, is_published)\n      VALUES (\n        ${formData.title},\n        ${formData.description},\n        ${formData.difficulty},\n        ${formData.points_reward},\n        ${formData.thumbnail_url || null},\n        ${parseInt(formData.teacher_id)},\n        ${formData.is_published}\n      )\n      RETURNING id\n    `\n\n    const courseId = result[0].id\n\n    // Create modules and their content\n    for (let i = 0; i < formData.modules.length; i++) {\n      const module = formData.modules[i]\n\n      const moduleResult = await sql`\n        INSERT INTO modules (course_id, title, description, order_index)\n        VALUES (${courseId}, ${module.title}, ${module.description}, ${i + 1})\n        RETURNING id\n      `\n\n      const moduleId = moduleResult[0].id\n\n      // Create lessons\n      for (let j = 0; j < module.lessons.length; j++) {\n        const lesson = module.lessons[j]\n\n        await sql`\n          INSERT INTO lessons (module_id, title, content, video_url, order_index, points_reward)\n          VALUES (\n            ${moduleId},\n            ${lesson.title},\n            ${lesson.content},\n            null,\n            ${j + 1},\n            ${lesson.points_reward}\n          )\n        `\n      }\n\n      // Create quiz if provided at module level\n      if (module.quiz) {\n        const quizResult = await sql`\n          INSERT INTO quizzes (module_id, title, passing_score, points_reward)\n          VALUES (\n            ${moduleId},\n            ${module.quiz.title},\n            ${module.quiz.passing_score},\n            ${module.quiz.points_reward}\n          )\n          RETURNING id\n        `\n\n        const quizId = quizResult[0].id\n\n        // Create questions\n        for (let k = 0; k < module.quiz.questions.length; k++) {\n          const question = module.quiz.questions[k]\n          const optionsJson = JSON.stringify(question.answers)\n          const correctAnswer = String.fromCharCode(65 + question.correct_answer_index) // A, B, C, D\n\n          await sql`\n            INSERT INTO quiz_questions (quiz_id, question, options, correct_answer, order_index)\n            VALUES (\n              ${quizId},\n              ${question.question},\n              ${optionsJson},\n              ${correctAnswer},\n              ${k + 1}\n            )\n          `\n        }\n      }\n    }\n\n    revalidatePath(\"/tutor\")\n    return { success: true, courseId }\n  } catch (error) {\n    console.error(\"[v0] Create course with content error:\", error)\n    return { success: false, error: \"Failed to create course\" }\n  }\n}\n\nexport async function completeLesson(formData: FormData) {\n  const lessonId = Number.parseInt(formData.get(\"lessonId\") as string)\n  const userId = Number.parseInt(formData.get(\"userId\") as string)\n  const courseId = Number.parseInt(formData.get(\"courseId\") as string)\n\n  try {\n    // Check if already completed\n    const existing = await sql`\n      SELECT * FROM lesson_progress\n      WHERE user_id = ${userId} AND lesson_id = ${lessonId}\n    `\n\n    if (existing.length > 0) {\n      return { success: false, error: \"Already completed\" }\n    }\n\n    // Mark lesson as complete\n    await sql`\n      INSERT INTO lesson_progress (user_id, lesson_id, completed, completed_at)\n      VALUES (${userId}, ${lessonId}, true, NOW())\n    `\n\n    // Get lesson points\n    const lessons = await sql`\n      SELECT points_reward FROM lessons WHERE id = ${lessonId}\n    `\n\n    const pointsReward = lessons[0]?.points_reward || 5\n\n    // Award points to student\n    await sql`\n      UPDATE users\n      SET points = points + ${pointsReward}\n      WHERE id = ${userId}\n    `\n\n    // Award points to teacher (1 point per lesson completion)\n    const teacherData = await sql`\n      SELECT c.teacher_id\n      FROM courses c\n      JOIN modules m ON c.id = m.course_id\n      JOIN lessons l ON m.id = l.module_id\n      WHERE l.id = ${lessonId}\n    `\n\n    if (teacherData.length > 0) {\n      const teacherId = teacherData[0].teacher_id\n      await sql`\n        UPDATE users\n        SET points = points + 1\n        WHERE id = ${teacherId}\n      `\n      await updateUserLevel(teacherId)\n    }\n\n    await updateUserLevel(userId)\n\n    await updateStreak(userId)\n\n    await updateDailyChallengeProgress(userId, \"lessons_completed\", 1)\n\n    // Create achievement for student\n    await sql`\n      INSERT INTO achievements (user_id, type, title, description, points_earned)\n      VALUES (\n        ${userId},\n        'lesson_completed',\n        'Lesson Complete',\n        'Completed a lesson',\n        ${pointsReward}\n      )\n    `\n\n    // Check if user should get \"First Steps\" badge\n    const lessonCount = await sql`\n      SELECT COUNT(*) as count FROM lesson_progress\n      WHERE user_id = ${userId} AND completed = true\n    `\n\n    if (lessonCount[0].count === 1) {\n      const badge = await sql`\n        SELECT id FROM badges WHERE name = 'First Steps'\n      `\n\n      if (badge.length > 0) {\n        await sql`\n          INSERT INTO user_badges (user_id, badge_id)\n          VALUES (${userId}, ${badge[0].id})\n          ON CONFLICT DO NOTHING\n        `\n      }\n    }\n\n    // Update course progress\n    await updateCourseProgress(userId, courseId)\n\n    revalidatePath(`/courses/${courseId}/lessons/${lessonId}`)\n    return { success: true }\n  } catch (error) {\n    console.error(\"[v0] Complete lesson error:\", error)\n    return { success: false, error: \"Failed to complete lesson\" }\n  }\n}\n\nexport async function submitQuiz(formData: FormData) {\n  const quizId = Number.parseInt(formData.get(\"quizId\") as string)\n  const userId = Number.parseInt(formData.get(\"userId\") as string)\n  const lessonId = Number.parseInt(formData.get(\"lessonId\") as string)\n  const courseId = Number.parseInt(formData.get(\"courseId\") as string)\n  const answersJson = formData.get(\"answers\") as string\n  const answers = JSON.parse(answersJson)\n\n  try {\n    // Get quiz details and questions\n    const quizzes = await sql`\n      SELECT * FROM quizzes WHERE id = ${quizId}\n    `\n\n    const quiz = quizzes[0]\n\n    const questions = await sql`\n      SELECT * FROM quiz_questions WHERE quiz_id = ${quizId}\n    `\n\n    // Calculate score\n    let correctCount = 0\n    questions.forEach((q) => {\n      if (answers[q.id] === q.correct_answer) {\n        correctCount++\n      }\n    })\n\n    const score = Math.round((correctCount / questions.length) * 100)\n    const passed = score >= quiz.passing_score\n\n    // Record attempt\n    await sql`\n      INSERT INTO quiz_attempts (user_id, quiz_id, score, answers, passed)\n      VALUES (${userId}, ${quizId}, ${score}, ${answersJson}, ${passed})\n    `\n\n    if (passed) {\n      // Award points\n      await sql`\n        UPDATE users \n        SET points = points + ${quiz.points_reward}\n        WHERE id = ${userId}\n      `\n\n      // Create achievement\n      await sql`\n        INSERT INTO achievements (user_id, type, title, description, points_earned)\n        VALUES (\n          ${userId}, \n          'quiz_passed', \n          'Quiz Passed',\n          'Successfully passed a quiz',\n          ${quiz.points_reward}\n        )\n      `\n\n      // Check for Quiz Master badge\n      const perfectQuizzes = await sql`\n        SELECT COUNT(*) as count FROM quiz_attempts\n        WHERE user_id = ${userId} AND score = 100\n      `\n\n      if (perfectQuizzes[0].count >= 3) {\n        const badge = await sql`\n          SELECT id FROM badges WHERE name = 'Quiz Master'\n        `\n\n        if (badge.length > 0) {\n          await sql`\n            INSERT INTO user_badges (user_id, badge_id)\n            VALUES (${userId}, ${badge[0].id})\n            ON CONFLICT DO NOTHING\n          `\n        }\n      }\n    }\n\n    revalidatePath(`/courses/${courseId}/lessons/${lessonId}`)\n    return { success: true, score, passed }\n  } catch (error) {\n    console.error(\"[v0] Submit quiz error:\", error)\n    return { success: false, error: \"Failed to submit quiz\" }\n  }\n}\n\nasync function updateCourseProgress(userId: number, courseId: number) {\n  // Get total lessons in course\n  const totalLessons = await sql`\n    SELECT COUNT(*) as count\n    FROM lessons l\n    JOIN modules m ON l.module_id = m.id\n    WHERE m.course_id = ${courseId}\n  `\n\n  // Get completed lessons\n  const completedLessons = await sql`\n    SELECT COUNT(*) as count\n    FROM lesson_progress lp\n    JOIN lessons l ON lp.lesson_id = l.id\n    JOIN modules m ON l.module_id = m.id\n    WHERE lp.user_id = ${userId} \n    AND m.course_id = ${courseId}\n    AND lp.completed = true\n  `\n\n  const total = totalLessons[0].count\n  const completed = completedLessons[0].count\n  const progress = total > 0 ? Math.round((completed / total) * 100) : 0\n\n  // Update enrollment\n  await sql`\n    UPDATE enrollments \n    SET progress = ${progress},\n        status = CASE WHEN ${progress} = 100 THEN 'completed' ELSE 'active' END,\n        completed_at = CASE WHEN ${progress} = 100 THEN NOW() ELSE NULL END\n    WHERE user_id = ${userId} AND course_id = ${courseId}\n  `\n\n  // If completed, award course completion points\n  if (progress === 100) {\n    const courses = await sql`\n      SELECT points_reward, teacher_id FROM courses WHERE id = ${courseId}\n    `\n\n    const pointsReward = courses[0]?.points_reward || 100\n    const teacherId = courses[0]?.teacher_id\n\n    // Award points to student\n    await sql`\n      UPDATE users\n      SET points = points + ${pointsReward}\n      WHERE id = ${userId}\n    `\n\n    // Award points to teacher (10 points per course completion)\n    if (teacherId) {\n      await sql`\n        UPDATE users\n        SET points = points + 10\n        WHERE id = ${teacherId}\n      `\n      await updateUserLevel(teacherId)\n    }\n\n    await sql`\n      INSERT INTO achievements (user_id, type, title, description, points_earned)\n      VALUES (\n        ${userId},\n        'course_completed',\n        'Course Complete',\n        'Finished an entire course',\n        ${pointsReward}\n      )\n    `\n\n    // Check for Course Champion badge for student\n    const badge = await sql`\n      SELECT id FROM badges WHERE name = 'Course Champion'\n    `\n\n    if (badge.length > 0) {\n      await sql`\n        INSERT INTO user_badges (user_id, badge_id)\n        VALUES (${userId}, ${badge[0].id})\n        ON CONFLICT DO NOTHING\n      `\n    }\n\n    // Check for teacher badges\n    if (teacherId) {\n      const totalCompletions = await sql`\n        SELECT COUNT(*) as count\n        FROM enrollments e\n        JOIN courses c ON e.course_id = c.id\n        WHERE c.teacher_id = ${teacherId} AND e.status = 'completed'\n      `\n\n      const completionCount = totalCompletions[0].count\n\n      // Effective Teacher (5 completions)\n      if (completionCount >= 5) {\n        const badge = await sql`\n          SELECT id FROM badges WHERE name = 'Effective Teacher'\n        `\n\n        if (badge.length > 0) {\n          await sql`\n            INSERT INTO user_badges (user_id, badge_id)\n            VALUES (${teacherId}, ${badge[0].id})\n            ON CONFLICT DO NOTHING\n          `\n        }\n      }\n\n      // Master Educator (20 completions)\n      if (completionCount >= 20) {\n        const badge = await sql`\n          SELECT id FROM badges WHERE name = 'Master Educator'\n        `\n\n        if (badge.length > 0) {\n          await sql`\n            INSERT INTO user_badges (user_id, badge_id)\n            VALUES (${teacherId}, ${badge[0].id})\n            ON CONFLICT DO NOTHING\n          `\n        }\n      }\n    }\n  }\n}\n\n// Helper function to update user level based on points\nasync function updateUserLevel(userId: number) {\n  const userData = await sql`\n    SELECT points, level FROM users WHERE id = ${userId}\n  `\n\n  if (userData.length === 0) return\n\n  const { points, level } = userData[0]\n\n  // Level calculation: level = floor(points / 100) + 1\n  const newLevel = Math.floor(points / 100) + 1\n\n  if (newLevel > level) {\n    await sql`\n      UPDATE users SET level = ${newLevel} WHERE id = ${userId}\n    `\n\n    // Award achievement for leveling up\n    await sql`\n      INSERT INTO achievements (user_id, type, title, description, points_earned)\n      VALUES (\n        ${userId}, \n        'level_up', \n        'Level Up!',\n        ${`Reached level ${newLevel}`},\n        10\n      )\n    `\n\n    // Check for level-based badges\n    if (newLevel === 5) {\n      const badge = await sql`SELECT id FROM badges WHERE name = 'Rising Star'`\n      if (badge.length > 0) {\n        await sql`\n          INSERT INTO user_badges (user_id, badge_id)\n          VALUES (${userId}, ${badge[0].id})\n          ON CONFLICT DO NOTHING\n        `\n      }\n    }\n\n    if (newLevel === 10) {\n      const badge = await sql`SELECT id FROM badges WHERE name = 'Overachiever'`\n      if (badge.length > 0) {\n        await sql`\n          INSERT INTO user_badges (user_id, badge_id)\n          VALUES (${userId}, ${badge[0].id})\n          ON CONFLICT DO NOTHING\n        `\n      }\n    }\n  }\n}\n\n// Helper function to update streak\nasync function updateStreak(userId: number) {\n  const today = new Date().toISOString().split(\"T\")[0]\n\n  const streakData = await sql`\n    SELECT * FROM user_streaks WHERE user_id = ${userId}\n  `\n\n  if (streakData.length === 0) {\n    // Create new streak\n    await sql`\n      INSERT INTO user_streaks (user_id, current_streak, longest_streak, last_activity_date)\n      VALUES (${userId}, 1, 1, ${today})\n    `\n  } else {\n    const streak = streakData[0]\n    const lastDate = streak.last_activity_date\n\n    if (lastDate === today) {\n      // Already updated today\n      return\n    }\n\n    const yesterday = new Date()\n    yesterday.setDate(yesterday.getDate() - 1)\n    const yesterdayStr = yesterday.toISOString().split(\"T\")[0]\n\n    if (lastDate === yesterdayStr) {\n      // Continuing streak\n      const newStreak = streak.current_streak + 1\n      const longestStreak = Math.max(newStreak, streak.longest_streak)\n\n      await sql`\n        UPDATE user_streaks \n        SET current_streak = ${newStreak},\n            longest_streak = ${longestStreak},\n            last_activity_date = ${today},\n            updated_at = NOW()\n        WHERE user_id = ${userId}\n      `\n\n      // Check for streak badges\n      if (newStreak === 7) {\n        const badge = await sql`SELECT id FROM badges WHERE name = 'Dedicated Learner'`\n        if (badge.length > 0) {\n          await sql`\n            INSERT INTO user_badges (user_id, badge_id)\n            VALUES (${userId}, ${badge[0].id})\n            ON CONFLICT DO NOTHING\n          `\n        }\n      }\n    } else {\n      // Streak broken, reset to 1\n      await sql`\n        UPDATE user_streaks \n        SET current_streak = 1,\n            last_activity_date = ${today},\n            updated_at = NOW()\n        WHERE user_id = ${userId}\n      `\n    }\n  }\n}\n\n// Helper function to update daily challenge progress\nasync function updateDailyChallengeProgress(userId: number, challengeType: string, increment: number) {\n  // Get active challenges of this type\n  const challenges = await sql`\n    SELECT id, target_value \n    FROM daily_challenges\n    WHERE challenge_type = ${challengeType}\n      AND start_date <= CURRENT_DATE \n      AND end_date >= CURRENT_DATE\n  `\n\n  for (const challenge of challenges) {\n    // Check if user has progress entry\n    const progress = await sql`\n      SELECT * FROM user_daily_challenges\n      WHERE user_id = ${userId} AND challenge_id = ${challenge.id}\n    `\n\n    if (progress.length === 0) {\n      // Create new progress entry\n      const newProgress = increment\n      const completed = newProgress >= challenge.target_value\n\n      await sql`\n        INSERT INTO user_daily_challenges (user_id, challenge_id, progress, completed, completed_at)\n        VALUES (${userId}, ${challenge.id}, ${newProgress}, ${completed}, ${completed ? \"NOW()\" : null})\n      `\n\n      if (completed) {\n        // Award points\n        const challengeData = await sql`\n          SELECT points_reward FROM daily_challenges WHERE id = ${challenge.id}\n        `\n        const pointsReward = challengeData[0]?.points_reward || 0\n\n        await sql`\n          UPDATE users SET points = points + ${pointsReward} WHERE id = ${userId}\n        `\n      }\n    } else if (!progress[0].completed) {\n      // Update existing progress\n      const newProgress = progress[0].progress + increment\n      const completed = newProgress >= challenge.target_value\n\n      await sql`\n        UPDATE user_daily_challenges\n        SET progress = ${newProgress},\n            completed = ${completed},\n            completed_at = ${completed ? \"NOW()\" : null}\n        WHERE user_id = ${userId} AND challenge_id = ${challenge.id}\n      `\n\n      if (completed) {\n        // Award points\n        const challengeData = await sql`\n          SELECT points_reward FROM daily_challenges WHERE id = ${challenge.id}\n        `\n        const pointsReward = challengeData[0]?.points_reward || 0\n\n        await sql`\n          UPDATE users SET points = points + ${pointsReward} WHERE id = ${userId}\n        `\n      }\n    }\n  }\n}\n"],"names":[],"mappings":";;;;;;;IAoiBsB,iBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 612, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/PC/Documents/NextJS%20Projects/gamified-learning-system/components/lesson-content.tsx"],"sourcesContent":["\"use client\"\n\nimport { useState } from \"react\"\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\"\nimport { Button } from \"@/components/ui/button\"\nimport { QuizComponent } from \"@/components/quiz-component\"\nimport { completeLesson } from \"@/app/actions/courses\"\nimport { CheckCircle2, BookOpen, Clock } from \"lucide-react\"\n\ninterface LessonContentProps {\n  lesson: {\n    id: number\n    title: string\n    content: string\n    video_url?: string\n    points_reward: number\n  }\n  quiz: any\n  questions: any[]\n  completed: boolean\n  userId: number\n  courseId: number\n}\n\nexport function LessonContent({ lesson, quiz, questions, completed, userId, courseId }: LessonContentProps) {\n  const [isCompleted, setIsCompleted] = useState(completed)\n  const [estimatedTime] = useState(Math.ceil(lesson.content.split(\" \").length / 200)) // ~200 words per minute\n\n  const handleComplete = async () => {\n    const formData = new FormData()\n    formData.append(\"lessonId\", lesson.id.toString())\n    formData.append(\"userId\", userId.toString())\n    formData.append(\"courseId\", courseId.toString())\n\n    const result = await completeLesson(formData)\n    if (result?.success) {\n      setIsCompleted(true)\n    }\n  }\n\n  return (\n    <div className=\"space-y-8\">\n      <Card className=\"border-primary/20 bg-gradient-to-br from-primary/5 to-transparent\">\n        <CardContent className=\"p-4 flex items-center gap-4\">\n          <Clock className=\"w-5 h-5 text-primary\" />\n          <div>\n            <p className=\"text-sm font-medium text-foreground\">Estimated time: {estimatedTime} min</p>\n            <p className=\"text-xs text-muted-foreground\">Complete to earn {lesson.points_reward} points</p>\n          </div>\n          {isCompleted && (\n            <div className=\"ml-auto flex items-center gap-2 text-accent\">\n              <CheckCircle2 className=\"w-5 h-5\" />\n              <span className=\"text-sm font-medium\">Completed</span>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {lesson.video_url && (\n        <Card>\n          <CardContent className=\"p-0\">\n            <div className=\"aspect-video bg-gradient-to-br from-primary/20 to-accent/20 rounded-lg flex items-center justify-center\">\n              <BookOpen className=\"w-16 h-16 text-primary\" />\n              <p className=\"text-muted-foreground ml-4\">Video: {lesson.video_url}</p>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Lesson Content</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"prose prose-gray max-w-none\">\n            <p className=\"text-foreground leading-relaxed whitespace-pre-wrap\">{lesson.content}</p>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card className=\"border-accent/30 bg-gradient-to-r from-accent/5 to-transparent\">\n        <CardContent className=\"p-6 text-center\">\n          <div className=\"inline-flex items-center gap-2 text-accent mb-2\">\n            <div className=\"h-px w-12 bg-accent/30\" />\n            <span className=\"text-sm font-medium\">End of Lesson</span>\n            <div className=\"h-px w-12 bg-accent/30\" />\n          </div>\n          <p className=\"text-sm text-muted-foreground\">\n            {quiz ? \"Complete the quiz below to test your knowledge\" : \"Mark as complete to continue\"}\n          </p>\n        </CardContent>\n      </Card>\n\n      {quiz && questions.length > 0 && (\n        <QuizComponent quiz={quiz} questions={questions} userId={userId} lessonId={lesson.id} courseId={courseId} />\n      )}\n\n      {!isCompleted && (\n        <Card className=\"bg-surface border-primary/30\">\n          <CardContent className=\"p-6 flex items-center justify-between\">\n            <div>\n              <h3 className=\"font-semibold text-foreground mb-1\">Mark as Complete</h3>\n              <p className=\"text-sm text-muted-foreground\">Earn {lesson.points_reward} points</p>\n            </div>\n            <Button onClick={handleComplete} className=\"bg-accent hover:bg-accent/90\">\n              <CheckCircle2 className=\"w-4 h-4 mr-2\" />\n              Complete Lesson\n            </Button>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  )\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;;;AAPA;;;;;;;AAwBO,SAAS,cAAc,EAAE,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE,SAAS,EAAE,MAAM,EAAE,QAAQ,EAAsB;;IACxG,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yKAAQ,EAAC;IAC/C,MAAM,CAAC,cAAc,GAAG,IAAA,yKAAQ,EAAC,KAAK,IAAI,CAAC,OAAO,OAAO,CAAC,KAAK,CAAC,KAAK,MAAM,GAAG,MAAM,wBAAwB;;IAE5G,MAAM,iBAAiB;QACrB,MAAM,WAAW,IAAI;QACrB,SAAS,MAAM,CAAC,YAAY,OAAO,EAAE,CAAC,QAAQ;QAC9C,SAAS,MAAM,CAAC,UAAU,OAAO,QAAQ;QACzC,SAAS,MAAM,CAAC,YAAY,SAAS,QAAQ;QAE7C,MAAM,SAAS,MAAM,IAAA,2KAAc,EAAC;QACpC,IAAI,QAAQ,SAAS;YACnB,eAAe;QACjB;IACF;IAEA,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC,oIAAI;gBAAC,WAAU;0BACd,cAAA,6LAAC,2IAAW;oBAAC,WAAU;;sCACrB,6LAAC,gNAAK;4BAAC,WAAU;;;;;;sCACjB,6LAAC;;8CACC,6LAAC;oCAAE,WAAU;;wCAAsC;wCAAiB;wCAAc;;;;;;;8CAClF,6LAAC;oCAAE,WAAU;;wCAAgC;wCAAkB,OAAO,aAAa;wCAAC;;;;;;;;;;;;;wBAErF,6BACC,6LAAC;4BAAI,WAAU;;8CACb,6LAAC,wOAAY;oCAAC,WAAU;;;;;;8CACxB,6LAAC;oCAAK,WAAU;8CAAsB;;;;;;;;;;;;;;;;;;;;;;;YAM7C,OAAO,SAAS,kBACf,6LAAC,oIAAI;0BACH,cAAA,6LAAC,2IAAW;oBAAC,WAAU;8BACrB,cAAA,6LAAC;wBAAI,WAAU;;0CACb,6LAAC,6NAAQ;gCAAC,WAAU;;;;;;0CACpB,6LAAC;gCAAE,WAAU;;oCAA6B;oCAAQ,OAAO,SAAS;;;;;;;;;;;;;;;;;;;;;;;0BAM1E,6LAAC,oIAAI;;kCACH,6LAAC,0IAAU;kCACT,cAAA,6LAAC,yIAAS;sCAAC;;;;;;;;;;;kCAEb,6LAAC,2IAAW;kCACV,cAAA,6LAAC;4BAAI,WAAU;sCACb,cAAA,6LAAC;gCAAE,WAAU;0CAAuD,OAAO,OAAO;;;;;;;;;;;;;;;;;;;;;;0BAKxF,6LAAC,oIAAI;gBAAC,WAAU;0BACd,cAAA,6LAAC,2IAAW;oBAAC,WAAU;;sCACrB,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;oCAAI,WAAU;;;;;;8CACf,6LAAC;oCAAK,WAAU;8CAAsB;;;;;;8CACtC,6LAAC;oCAAI,WAAU;;;;;;;;;;;;sCAEjB,6LAAC;4BAAE,WAAU;sCACV,OAAO,mDAAmD;;;;;;;;;;;;;;;;;YAKhE,QAAQ,UAAU,MAAM,GAAG,mBAC1B,6LAAC,oJAAa;gBAAC,MAAM;gBAAM,WAAW;gBAAW,QAAQ;gBAAQ,UAAU,OAAO,EAAE;gBAAE,UAAU;;;;;;YAGjG,CAAC,6BACA,6LAAC,oIAAI;gBAAC,WAAU;0BACd,cAAA,6LAAC,2IAAW;oBAAC,WAAU;;sCACrB,6LAAC;;8CACC,6LAAC;oCAAG,WAAU;8CAAqC;;;;;;8CACnD,6LAAC;oCAAE,WAAU;;wCAAgC;wCAAM,OAAO,aAAa;wCAAC;;;;;;;;;;;;;sCAE1E,6LAAC,wIAAM;4BAAC,SAAS;4BAAgB,WAAU;;8CACzC,6LAAC,wOAAY;oCAAC,WAAU;;;;;;gCAAiB;;;;;;;;;;;;;;;;;;;;;;;;AAQvD;GAzFgB;KAAA"}}]
}