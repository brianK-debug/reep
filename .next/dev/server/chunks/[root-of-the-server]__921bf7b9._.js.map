{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/PC/Documents/NextJS%20Projects/gamified-learning-system/lib/auth.ts"],"sourcesContent":["import { cookies } from \"next/headers\"\nimport { SignJWT, jwtVerify } from \"jose\"\n\nconst secret = new TextEncoder().encode(process.env.JWT_SECRET || \"reep-secret-key-change-in-production\")\n\nexport interface User {\n  id: number\n  email: string\n  full_name: string\n  role: \"student\" | \"teacher\" | \"admin\"\n  avatar_url?: string\n  points: number\n  level: number\n}\n\nexport async function hashPassword(password: string): Promise<string> {\n  const bcrypt = await import(\"bcryptjs\")\n  return bcrypt.default.hash(password, 10)\n}\n\nexport async function verifyPassword(password: string, hash: string): Promise<boolean> {\n  const bcrypt = await import(\"bcryptjs\")\n  return bcrypt.default.compare(password, hash)\n}\n\nexport async function createToken(user: User): Promise<string> {\n  return new SignJWT({ user }).setProtectedHeader({ alg: \"HS256\" }).setExpirationTime(\"7d\").sign(secret)\n}\n\nexport async function verifyToken(token: string): Promise<User | null> {\n  try {\n    const { payload } = await jwtVerify(token, secret)\n    return payload.user as User\n  } catch {\n    return null\n  }\n}\n\nexport async function getSession(): Promise<User | null> {\n  const cookieStore = await cookies()\n  const token = cookieStore.get(\"auth-token\")\n\n  if (!token) {\n    return null\n  }\n\n  return verifyToken(token.value)\n}\n\nexport async function setSession(user: User): Promise<void> {\n  const token = await createToken(user)\n  const cookieStore = await cookies()\n\n  cookieStore.set(\"auth-token\", token, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === \"production\",\n    sameSite: \"lax\",\n    maxAge: 60 * 60 * 24 * 7, // 7 days\n    path: \"/\",\n  })\n}\n\nexport async function clearSession(): Promise<void> {\n  const cookieStore = await cookies()\n  cookieStore.delete(\"auth-token\")\n}\n\nexport async function requireAuth(): Promise<User> {\n  const user = await getSession()\n\n  if (!user) {\n    throw new Error(\"Unauthorized\")\n  }\n\n  return user\n}\n\nexport async function requireRole(role: \"student\" | \"teacher\" | \"admin\"): Promise<User> {\n  const user = await requireAuth()\n\n  if (user.role !== role && user.role !== \"admin\") {\n    throw new Error(\"Forbidden\")\n  }\n\n  return user\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAAA;;;AAEA,MAAM,SAAS,IAAI,cAAc,MAAM,CAAC,QAAQ,GAAG,CAAC,UAAU,IAAI;AAY3D,eAAe,aAAa,QAAgB;IACjD,MAAM,SAAS;IACf,OAAO,OAAO,OAAO,CAAC,IAAI,CAAC,UAAU;AACvC;AAEO,eAAe,eAAe,QAAgB,EAAE,IAAY;IACjE,MAAM,SAAS;IACf,OAAO,OAAO,OAAO,CAAC,OAAO,CAAC,UAAU;AAC1C;AAEO,eAAe,YAAY,IAAU;IAC1C,OAAO,IAAI,gKAAO,CAAC;QAAE;IAAK,GAAG,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAAG,iBAAiB,CAAC,MAAM,IAAI,CAAC;AACjG;AAEO,eAAe,YAAY,KAAa;IAC7C,IAAI;QACF,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,oKAAS,EAAC,OAAO;QAC3C,OAAO,QAAQ,IAAI;IACrB,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC;IAE9B,IAAI,CAAC,OAAO;QACV,OAAO;IACT;IAEA,OAAO,YAAY,MAAM,KAAK;AAChC;AAEO,eAAe,WAAW,IAAU;IACzC,MAAM,QAAQ,MAAM,YAAY;IAChC,MAAM,cAAc,MAAM,IAAA,0IAAO;IAEjC,YAAY,GAAG,CAAC,cAAc,OAAO;QACnC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,QAAQ,KAAK,KAAK,KAAK;QACvB,MAAM;IACR;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,YAAY,MAAM,CAAC;AACrB;AAEO,eAAe;IACpB,MAAM,OAAO,MAAM;IAEnB,IAAI,CAAC,MAAM;QACT,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO;AACT;AAEO,eAAe,YAAY,IAAqC;IACrE,MAAM,OAAO,MAAM;IAEnB,IAAI,KAAK,IAAI,KAAK,QAAQ,KAAK,IAAI,KAAK,SAAS;QAC/C,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO;AACT"}},
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/PC/Documents/NextJS%20Projects/gamified-learning-system/proxy.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport type { NextRequest } from \"next/server\"\nimport { verifyToken } from \"./lib/auth\"\n\nconst publicRoutes = [\"/\", \"/sign-in\", \"/sign-up\"]\nconst authRoutes = [\"/sign-in\", \"/sign-up\"]\n\nexport async function proxy(request: NextRequest) {\n  const token = request.cookies.get(\"auth-token\")\n  const { pathname } = request.nextUrl\n\n  // Allow public routes\n  if (publicRoutes.includes(pathname)) {\n    if (token && authRoutes.includes(pathname)) {\n      const user = await verifyToken(token.value)\n      if (user) {\n        return NextResponse.redirect(new URL(\"/dashboard\", request.url))\n      }\n    }\n    return NextResponse.next()\n  }\n\n  // Protect all other routes\n  if (!token) {\n    return NextResponse.redirect(new URL(\"/sign-in\", request.url))\n  }\n\n  const user = await verifyToken(token.value)\n\n  if (!user) {\n    const response = NextResponse.redirect(new URL(\"/sign-in\", request.url))\n    response.cookies.delete(\"auth-token\")\n    return response\n  }\n\n  // Check admin routes\n  if (pathname.startsWith(\"/admin\") && user.role !== \"admin\") {\n    return NextResponse.redirect(new URL(\"/dashboard\", request.url))\n  }\n\n  // Check teacher routes\n  if (pathname.startsWith(\"/teacher\") && user.role !== \"teacher\" && user.role !== \"admin\") {\n    return NextResponse.redirect(new URL(\"/dashboard\", request.url))\n  }\n\n  return NextResponse.next()\n}\n\nexport const config = {\n  matcher: [\"/((?!api|_next/static|_next/image|favicon.ico|.*\\\\..*).*)\"],\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAEA;;;AAEA,MAAM,eAAe;IAAC;IAAK;IAAY;CAAW;AAClD,MAAM,aAAa;IAAC;IAAY;CAAW;AAEpC,eAAe,MAAM,OAAoB;IAC9C,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC;IAClC,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IAEpC,sBAAsB;IACtB,IAAI,aAAa,QAAQ,CAAC,WAAW;QACnC,IAAI,SAAS,WAAW,QAAQ,CAAC,WAAW;YAC1C,MAAM,OAAO,MAAM,IAAA,0HAAW,EAAC,MAAM,KAAK;YAC1C,IAAI,MAAM;gBACR,OAAO,8IAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,cAAc,QAAQ,GAAG;YAChE;QACF;QACA,OAAO,8IAAY,CAAC,IAAI;IAC1B;IAEA,2BAA2B;IAC3B,IAAI,CAAC,OAAO;QACV,OAAO,8IAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,YAAY,QAAQ,GAAG;IAC9D;IAEA,MAAM,OAAO,MAAM,IAAA,0HAAW,EAAC,MAAM,KAAK;IAE1C,IAAI,CAAC,MAAM;QACT,MAAM,WAAW,8IAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,YAAY,QAAQ,GAAG;QACtE,SAAS,OAAO,CAAC,MAAM,CAAC;QACxB,OAAO;IACT;IAEA,qBAAqB;IACrB,IAAI,SAAS,UAAU,CAAC,aAAa,KAAK,IAAI,KAAK,SAAS;QAC1D,OAAO,8IAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,cAAc,QAAQ,GAAG;IAChE;IAEA,uBAAuB;IACvB,IAAI,SAAS,UAAU,CAAC,eAAe,KAAK,IAAI,KAAK,aAAa,KAAK,IAAI,KAAK,SAAS;QACvF,OAAO,8IAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,cAAc,QAAQ,GAAG;IAChE;IAEA,OAAO,8IAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;KAA4D;AACxE"}}]
}