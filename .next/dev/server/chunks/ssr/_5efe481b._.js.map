{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/PC/Documents/NextJS%20Projects/gamified-learning-system/lib/db.ts"],"sourcesContent":["import { neon } from \"@neondatabase/serverless\"\n\nconst sql = neon(process.env.DATABASE_URL!)\n\nexport default sql\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,MAAM,IAAA,8JAAI,EAAC,QAAQ,GAAG,CAAC,YAAY;uCAE1B"}},
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/PC/Documents/NextJS%20Projects/gamified-learning-system/lib/auth.ts"],"sourcesContent":["import { cookies } from \"next/headers\"\nimport { SignJWT, jwtVerify } from \"jose\"\n\nconst secret = new TextEncoder().encode(process.env.JWT_SECRET || \"reep-secret-key-change-in-production\")\n\nexport interface User {\n  id: number\n  email: string\n  full_name: string\n  role: \"student\" | \"teacher\" | \"admin\"\n  avatar_url?: string\n  points: number\n  level: number\n}\n\nexport async function hashPassword(password: string): Promise<string> {\n  const bcrypt = await import(\"bcryptjs\")\n  return bcrypt.default.hash(password, 10)\n}\n\nexport async function verifyPassword(password: string, hash: string): Promise<boolean> {\n  const bcrypt = await import(\"bcryptjs\")\n  return bcrypt.default.compare(password, hash)\n}\n\nexport async function createToken(user: User): Promise<string> {\n  return new SignJWT({ user }).setProtectedHeader({ alg: \"HS256\" }).setExpirationTime(\"7d\").sign(secret)\n}\n\nexport async function verifyToken(token: string): Promise<User | null> {\n  try {\n    const { payload } = await jwtVerify(token, secret)\n    return payload.user as User\n  } catch {\n    return null\n  }\n}\n\nexport async function getSession(): Promise<User | null> {\n  const cookieStore = await cookies()\n  const token = cookieStore.get(\"auth-token\")\n\n  if (!token) {\n    return null\n  }\n\n  return verifyToken(token.value)\n}\n\nexport async function setSession(user: User): Promise<void> {\n  const token = await createToken(user)\n  const cookieStore = await cookies()\n\n  cookieStore.set(\"auth-token\", token, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === \"production\",\n    sameSite: \"lax\",\n    maxAge: 60 * 60 * 24 * 7, // 7 days\n    path: \"/\",\n  })\n}\n\nexport async function clearSession(): Promise<void> {\n  const cookieStore = await cookies()\n  cookieStore.delete(\"auth-token\")\n}\n\nexport async function requireAuth(): Promise<User> {\n  const user = await getSession()\n\n  if (!user) {\n    throw new Error(\"Unauthorized\")\n  }\n\n  return user\n}\n\nexport async function requireRole(role: \"student\" | \"teacher\" | \"admin\"): Promise<User> {\n  const user = await requireAuth()\n\n  if (user.role !== role && user.role !== \"admin\") {\n    throw new Error(\"Forbidden\")\n  }\n\n  return user\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAAA;;;AAEA,MAAM,SAAS,IAAI,cAAc,MAAM,CAAC,QAAQ,GAAG,CAAC,UAAU,IAAI;AAY3D,eAAe,aAAa,QAAgB;IACjD,MAAM,SAAS;IACf,OAAO,OAAO,OAAO,CAAC,IAAI,CAAC,UAAU;AACvC;AAEO,eAAe,eAAe,QAAgB,EAAE,IAAY;IACjE,MAAM,SAAS;IACf,OAAO,OAAO,OAAO,CAAC,OAAO,CAAC,UAAU;AAC1C;AAEO,eAAe,YAAY,IAAU;IAC1C,OAAO,IAAI,gKAAO,CAAC;QAAE;IAAK,GAAG,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAAG,iBAAiB,CAAC,MAAM,IAAI,CAAC;AACjG;AAEO,eAAe,YAAY,KAAa;IAC7C,IAAI;QACF,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,oKAAS,EAAC,OAAO;QAC3C,OAAO,QAAQ,IAAI;IACrB,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC;IAE9B,IAAI,CAAC,OAAO;QACV,OAAO;IACT;IAEA,OAAO,YAAY,MAAM,KAAK;AAChC;AAEO,eAAe,WAAW,IAAU;IACzC,MAAM,QAAQ,MAAM,YAAY;IAChC,MAAM,cAAc,MAAM,IAAA,0IAAO;IAEjC,YAAY,GAAG,CAAC,cAAc,OAAO;QACnC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,QAAQ,KAAK,KAAK,KAAK;QACvB,MAAM;IACR;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,YAAY,MAAM,CAAC;AACrB;AAEO,eAAe;IACpB,MAAM,OAAO,MAAM;IAEnB,IAAI,CAAC,MAAM;QACT,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO;AACT;AAEO,eAAe,YAAY,IAAqC;IACrE,MAAM,OAAO,MAAM;IAEnB,IAAI,KAAK,IAAI,KAAK,QAAQ,KAAK,IAAI,KAAK,SAAS;QAC/C,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO;AACT"}},
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/PC/Documents/NextJS%20Projects/gamified-learning-system/app/actions/auth.ts"],"sourcesContent":["\"use server\"\n\nimport { redirect } from \"next/navigation\"\nimport sql from \"@/lib/db\"\nimport { hashPassword, verifyPassword, setSession, clearSession, getSession, type User } from \"@/lib/auth\"\n\nexport async function signUp(prevState: any, formData: FormData) {\n  const email = formData.get(\"email\") as string\n  const password = formData.get(\"password\") as string\n  const fullName = formData.get(\"fullName\") as string\n  const role = formData.get(\"role\") as string\n\n  if (!email || !password || !fullName || !role) {\n    return { error: \"All fields are required\" }\n  }\n\n  if (password.length < 8) {\n    return { error: \"Password must be at least 8 characters\" }\n  }\n\n  if (![\"student\", \"teacher\"].includes(role)) {\n    return { error: \"Invalid role selected\" }\n  }\n\n  try {\n    // Check if user already exists\n    const existingUser = await sql`\n      SELECT id FROM users WHERE email = ${email}\n    `\n\n    if (existingUser.length > 0) {\n      return { error: \"User with this email already exists\" }\n    }\n\n    // Create new user\n    const passwordHash = await hashPassword(password)\n    const result = await sql`\n      INSERT INTO users (email, password_hash, full_name, role)\n      VALUES (${email}, ${passwordHash}, ${fullName}, ${role})\n      RETURNING id, email, full_name, role, avatar_url, points, level\n    `\n\n    const user = result[0] as User\n\n    await setSession(user)\n    return { success: \"Account created successfully! Welcome to REEP.\" }\n  } catch (error) {\n    console.error(\"[v0] Sign up error:\", error)\n    return { error: \"Failed to create account. Please try again.\" }\n  }\n}\n\nexport async function signIn(prevState: any, formData: FormData) {\n  const email = formData.get(\"email\") as string\n  const password = formData.get(\"password\") as string\n\n  if (!email || !password) {\n    return { error: \"Email and password are required\" }\n  }\n\n  let user: User & { password_hash: string } | null = null\n\n  try {\n    const result = await sql`\n      SELECT id, email, password_hash, full_name, role, avatar_url, points, level\n      FROM users\n      WHERE email = ${email}\n    `\n\n    if (result.length === 0) {\n      return { error: \"Invalid email or password\" }\n    }\n\n    user = result[0] as User & { password_hash: string }\n\n    const isValid = await verifyPassword(password, user.password_hash)\n\n    if (!isValid) {\n      return { error: \"Invalid email or password\" }\n    }\n\n    const { password_hash, ...userWithoutPassword } = user\n\n    await setSession(userWithoutPassword as User)\n    return { success: \"Signed in successfully! Redirecting...\", role: user!.role }\n  }\n  catch (error) {\n    console.error(\"[v0] Sign in error:\", error)\n    return { error: \"Failed to sign in. Please try again.\" }\n  }\n}\n\nexport async function signOut() {\n  await clearSession()\n  redirect(\"/\")\n}\n\nexport async function getCurrentUser() {\n  return await getSession()\n}\n"],"names":[],"mappings":";;;;;;;;;;;AAEA;AAAA;AACA;AACA;;;;;;AAEO,eAAe,OAAO,SAAc,EAAE,QAAkB;IAC7D,MAAM,QAAQ,SAAS,GAAG,CAAC;IAC3B,MAAM,WAAW,SAAS,GAAG,CAAC;IAC9B,MAAM,WAAW,SAAS,GAAG,CAAC;IAC9B,MAAM,OAAO,SAAS,GAAG,CAAC;IAE1B,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,YAAY,CAAC,MAAM;QAC7C,OAAO;YAAE,OAAO;QAA0B;IAC5C;IAEA,IAAI,SAAS,MAAM,GAAG,GAAG;QACvB,OAAO;YAAE,OAAO;QAAyC;IAC3D;IAEA,IAAI,CAAC;QAAC;QAAW;KAAU,CAAC,QAAQ,CAAC,OAAO;QAC1C,OAAO;YAAE,OAAO;QAAwB;IAC1C;IAEA,IAAI;QACF,+BAA+B;QAC/B,MAAM,eAAe,MAAM,oHAAG,CAAC;yCACM,EAAE,MAAM;IAC7C,CAAC;QAED,IAAI,aAAa,MAAM,GAAG,GAAG;YAC3B,OAAO;gBAAE,OAAO;YAAsC;QACxD;QAEA,kBAAkB;QAClB,MAAM,eAAe,MAAM,IAAA,2HAAY,EAAC;QACxC,MAAM,SAAS,MAAM,oHAAG,CAAC;;cAEf,EAAE,MAAM,EAAE,EAAE,aAAa,EAAE,EAAE,SAAS,EAAE,EAAE,KAAK;;IAEzD,CAAC;QAED,MAAM,OAAO,MAAM,CAAC,EAAE;QAEtB,MAAM,IAAA,yHAAU,EAAC;QACjB,OAAO;YAAE,SAAS;QAAiD;IACrE,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO;YAAE,OAAO;QAA8C;IAChE;AACF;AAEO,eAAe,OAAO,SAAc,EAAE,QAAkB;IAC7D,MAAM,QAAQ,SAAS,GAAG,CAAC;IAC3B,MAAM,WAAW,SAAS,GAAG,CAAC;IAE9B,IAAI,CAAC,SAAS,CAAC,UAAU;QACvB,OAAO;YAAE,OAAO;QAAkC;IACpD;IAEA,IAAI,OAAgD;IAEpD,IAAI;QACF,MAAM,SAAS,MAAM,oHAAG,CAAC;;;oBAGT,EAAE,MAAM;IACxB,CAAC;QAED,IAAI,OAAO,MAAM,KAAK,GAAG;YACvB,OAAO;gBAAE,OAAO;YAA4B;QAC9C;QAEA,OAAO,MAAM,CAAC,EAAE;QAEhB,MAAM,UAAU,MAAM,IAAA,6HAAc,EAAC,UAAU,KAAK,aAAa;QAEjE,IAAI,CAAC,SAAS;YACZ,OAAO;gBAAE,OAAO;YAA4B;QAC9C;QAEA,MAAM,EAAE,aAAa,EAAE,GAAG,qBAAqB,GAAG;QAElD,MAAM,IAAA,yHAAU,EAAC;QACjB,OAAO;YAAE,SAAS;YAA0C,MAAM,KAAM,IAAI;QAAC;IAC/E,EACA,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO;YAAE,OAAO;QAAuC;IACzD;AACF;AAEO,eAAe;IACpB,MAAM,IAAA,2HAAY;IAClB,IAAA,iMAAQ,EAAC;AACX;AAEO,eAAe;IACpB,OAAO,MAAM,IAAA,yHAAU;AACzB;;;IA7FsB;IA8CA;IAwCA;IAKA;;AA3FA,+OAAA;AA8CA,+OAAA;AAwCA,+OAAA;AAKA,+OAAA"}},
    {"offset": {"line": 240, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/PC/Documents/NextJS%20Projects/gamified-learning-system/.next-internal/server/app/sign-in/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {signIn as '609c0bfc21541e295b494afee4c0911da9f585e8e4'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}